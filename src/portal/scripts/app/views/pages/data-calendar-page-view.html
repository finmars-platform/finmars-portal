<div class="data-calendar-page p-24">

    <h1 layout="row">Finmars Calendar
        <md-checkbox class="data-calendar-filter-checkbox"
                     data-ng-click="vm.bigPicture = !vm.bigPicture; vm.renderCalendar()" data-ng-checked="vm.bigPicture"
                     style="margin-top: 10px;
    margin-left: 10px;">
            Big Picture
        </md-checkbox>
    </h1>

    <div layout="row">

        <md-button data-ng-click="vm.refresh()" class="md-raised md-primary">Refresh</md-button>


    </div>
    <div>
        <div class="m-r-8" style="padding-top: 4px;">Filters:</div>
        <div layout="row">

            <md-checkbox class="data-calendar-filter-checkbox" data-ng-click="vm.toggleFilter('schedule')"
                         data-ng-checked="vm.filter.indexOf('schedule') !== -1">
                Show Schedules
            </md-checkbox>
            <md-checkbox class="data-calendar-filter-checkbox" data-ng-click="vm.toggleFilter('schedule_instance')"
                         data-ng-checked="vm.filter.indexOf('schedule_instance') !== -1">
                Show Schedules Instances
            </md-checkbox>
            <md-checkbox class="data-calendar-filter-checkbox" data-ng-click="vm.toggleFilter('system_message')"
                         data-ng-checked="vm.filter.indexOf('system_message') !== -1">
                Show Manual System Messages
            </md-checkbox>
            <md-checkbox class="data-calendar-filter-checkbox" data-ng-click="vm.toggleFilter('data_procedure')"
                         data-ng-checked="vm.filter.indexOf('data_procedure') !== -1">
                Show Data Procedures
            </md-checkbox>
            <md-checkbox class="data-calendar-filter-checkbox" data-ng-click="vm.toggleFilter('expression_procedure')"
                         data-ng-checked="vm.filter.indexOf('expression_procedure') !== -1">
                Show Expression Procedures
            </md-checkbox>
            <md-checkbox class="data-calendar-filter-checkbox" data-ng-click="vm.toggleFilter('pricing_procedure')"
                         data-ng-checked="vm.filter.indexOf('pricing_procedure') !== -1">
                Show Pricing Procedures
            </md-checkbox>
            <md-checkbox class="data-calendar-filter-checkbox" data-ng-click="vm.toggleFilter('celery_task')"
                         data-ng-checked="vm.filter.indexOf('celery_task') !== -1">
                Show Tasks
            </md-checkbox>
        </div>

    </div>

    <div data-ng-if="vm.readyStatus.content" class="data-calendar-page-content">


        <div id="calendar" class="{{vm.bigPicture ? 'big-calendar' : ''}}">

        </div>

        <div class="calendar-event-detail">

            <div data-ng-if="vm.calendarEvent" class="position-relative calendar-event-detail-content">

                <a data-ng-click="vm.loadCalendarEvent($event)" data-ng-if="vm.calendarEventPayload"
                   class="refresh-calendar-event-payload">Refresh</a>
                <a data-ng-click="vm.deleteCeleryTask($event)"
                   data-ng-if="vm.calendarEventPayload && vm.calendarEvent.extendedProps.type === 'celery_task'"
                   class="delete-calendar-event-payload">Delete</a>

                <h1 style="word-break: break-word; font-size: 24px;">{{vm.calendarEvent.title}}</h1>
                <div class="calendar-event-detail-field">Start Date: {{vm.calendarEvent.start | date:'yyyy-MM-dd' : 'UTC'}}</div>
                <div class="calendar-event-detail-field">Start Time: {{vm.calendarEvent.start | date:'HH:mm' : 'UTC'}}</div>
                <div class="calendar-event-detail-field" data-ng-if="vm.calendarEvent.extendedProps.id">Id: {{vm.calendarEvent.extendedProps.id}}</div>
                <div class="calendar-event-detail-field">Type: {{vm.calendarEvent.extendedProps.type}}</div>

                <div data-ng-if="vm.calendarEvent.extendedProps.type === 'system_message'">

                    <div class="calendar-event-detail-field">Description: {{vm.calendarEvent.extendedProps.payload.description}}</div>

                </div>

                <div data-ng-if="vm.calendarEvent.extendedProps.type === 'schedule_instance'">
                    <div class="calendar-event-detail-field">Status: {{vm.calendarEvent.extendedProps.payload.status}}</div>
                    <div class="calendar-event-detail-field">Schedule ID: {{vm.calendarEvent.extendedProps.payload.schedule_object.id}}</div>
                    <div class="calendar-event-detail-field">Schedule: {{vm.calendarEvent.extendedProps.payload.schedule_object.user_code}}</div>
                    <div class="calendar-event-detail-field">Progress: {{vm.calendarEvent.extendedProps.payload.current}} /
                        {{vm.calendarEvent.extendedProps.payload.total}}
                    </div>

                </div>

                <div data-ng-if="vm.calendarEventPayloadLoading">
                    <div layout="row" layout-sm="column" layout-align="space-around">
                        <progress-circular diameter="50"></progress-circular>
                    </div>
                </div>

                <div data-ng-if="vm.calendarEventPayload">


                    <div data-ng-if="vm.calendarEvent.extendedProps.type === 'celery_task'">

                        <div class="calendar-event-detail-field">Status:
                            <span data-ng-if="vm.calendarEventPayload.status == 'D'"
                                  class="{{vm.calendarEventPayload.status == 'D' ? 'calendar-detail-status-green' : '' }}">
                                Success
                            </span>
                            <span data-ng-if="vm.calendarEventPayload.status == 'E'"
                                  class="{{vm.calendarEventPayload.status == 'E' ? 'calendar-detail-status-red' : '' }}">
                                Error
                            </span>
                            <span data-ng-if="vm.calendarEventPayload.status != 'D' && vm.calendarEventPayload.status != 'D'">
                            {{vm.calendarEventPayload.status}}
                            </span>
                        </div>
                        <div class="calendar-event-detail-field">Type: {{vm.calendarEventPayload.type}}</div>

                        <div data-ng-if="vm.calendarEventPayload.member_object">
                            Member: {{vm.calendarEventPayload.member_object.username}}
                        </div>

                        <hr>

                        <div class="calendar-event-detail-field" data-ng-if="vm.calendarEventPayload.verbose_result">
                            Verbose result:

                            <div>
                                {{vm.calendarEventPayload.verbose_result}}
                            </div>

                            <hr>
                        </div>


                        <div class="calendar-event-detail-field" data-ng-if="vm.calendarEventPayload.notes">
                            Notes:
                            <div>
                                {{vm.calendarEventPayload.notes}}
                            </div>


                        </div>

                        <div class="calendar-event-detail-field" data-ng-if="vm.calendarEventPayload.error_message">
                            Error Message:
                            <div class="calendar-event-detail-error-message">
                                {{vm.calendarEventPayload.error_message}}
                            </div>

                            <hr>
                        </div>

                        <div class="calendar-event-detail-field">

                            Options

                            <div style="max-height: 300px; overflow: auto">

                                <pre>{{vm.calendarEventPayload.options_object}}
                                </pre>

                            </div>
                            <hr>

                        </div>

                        <div class="calendar-event-detail-field">

                            Progress

                            <div style="max-height: 300px; overflow: auto">

                                <pre>{{vm.calendarEventPayload.progress_object}}
                                </pre>

                            </div>

                            <hr>

                        </div>

                        <div class="calendar-event-detail-field">

                            Results

                            <div style="max-height: 300px; overflow: auto">

                                <pre>{{vm.calendarEventPayload.result_object}}
                                </pre>

                            </div>

                            <hr>

                        </div>

                        <div class="calendar-event-detail-field" data-ng-if="vm.calendarEventPayload.attachments.length">

                            Attachments

                            <div data-ng-repeat="item in vm.calendarEventPayload.attachments">
                                <span class="download-file-button"
                                      data-ng-click="vm.downloadFile($event, item)">{{item.file_report_object.name}}</span>
                            </div>

                        </div>


                    </div>

                    <div data-ng-if="vm.calendarEvent.extendedProps.type === 'pricing_procedure'">

                        <div class="calendar-event-detail-field" >Status: {{vm.calendarEventPayload.status}}</div>
                        <div class="calendar-event-detail-field" >Action: {{vm.calendarEventPayload.action_verbose}}</div>
                        <div class="calendar-event-detail-field">Provider: {{vm.calendarEventPayload.provider_verbose}}</div>
                        <div class="calendar-event-detail-field">Procedure: {{vm.calendarEventPayload.procedure_object.user_code}}</div>

                        <hr>
                        <div class="calendar-event-detail-field">Success prices: {{vm.calendarEventPayload.successful_prices_count}}</div>

                        <hr>

                        <div class="calendar-event-detail-field">Error message:
                            <div class="calendar-event-detail-error-message">{{vm.calendarEventPayload.error_message}}</div>
                        </div>
                        <div class="calendar-event-detail-field">Error Prices: {{vm.calendarEventPayload.error_prices_count}}</div>

                        <hr>

                        <div class="calendar-event-detail-field">
                            Request Data
                            <div style="max-height: 300px; overflow: auto">
                                <pre>{{vm.calendarEventPayload.request_data}}</pre>
                            </div>

                        </div>

                        <hr>

                        <div class="calendar-event-detail-field">
                            Response Data
                            <div style="max-height: 300px; overflow: auto">
                                <pre>{{vm.calendarEventPayload.response_data}}</pre>
                            </div>

                        </div>


                    </div>

                    <div data-ng-if="vm.calendarEvent.extendedProps.type === 'data_procedure'">

                        <div class="calendar-event-detail-field">Status: {{vm.calendarEventPayload.status}}</div>
                        <div class="calendar-event-detail-field">Procedure: {{vm.calendarEventPayload.procedure_object.user_code}}</div>

                        <hr>

                        <div class="calendar-event-detail-field">Error message:
                            <div class="calendar-event-detail-error-message">{{vm.calendarEventPayload.error_message}}</div>
                        </div>

                        <hr>


                        <div class="calendar-event-detail-field">
                            Request Data
                            <div style="max-height: 300px; overflow: auto">
                                <pre>{{vm.calendarEventPayload.request_data}}</pre>
                            </div>

                        </div>


                    </div>

                    <div data-ng-if="vm.calendarEvent.extendedProps.type === 'expression_procedure'">

                        <div class="calendar-event-detail-field">Status: {{vm.calendarEvent.extendedProps.payload.status}}</div>
                        <div class="calendar-event-detail-field">Procedure: [{{vm.calendarEventPayload.procedure_object.id}}]
                            {{vm.calendarEventPayload.procedure_object.name}}
                            ({{vm.calendarEventPayload.procedure_object.user_code}})
                        </div>


                        <hr>

                        <div class="calendar-event-detail-field">Error message:
                            <div class="calendar-event-detail-error-message">{{vm.calendarEventPayload.error_message}}</div>
                        </div>

                        <hr>

                        <div class="calendar-event-detail-field">
                            Notes
                            <div style="max-height: 300px; overflow: auto">
                                <pre>{{vm.calendarEventPayload.notes}}</pre>
                            </div>

                        </div>

                        <hr>

                        <div class="calendar-event-detail-field">
                            Result
                            <div style="max-height: 300px; overflow: auto">
                                <pre>{{vm.calendarEventPayload.result}}</pre>
                            </div>

                        </div>


                    </div>


                </div>


            </div>
            <div data-ng-if="!vm.calendarEvent">
                <h1>Click on event to see details</h1>

            </div>

        </div>

    </div>

    <div data-ng-if="!vm.readyStatus.content" style="width: 100%">
        <div layout="row" layout-sm="column" layout-align="space-around">
            <progress-circular diameter="100"></progress-circular>
        </div>
    </div>

</div>