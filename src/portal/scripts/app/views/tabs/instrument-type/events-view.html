<div data-ng-controller="InstrumentTypeEventSchedulesTabController as vm">

    <div class="instrument-type-events-tab-view"
         data-ng-if="vm.readyStatus.gridTable">

        <v-accordion class="instrument-type-accordion vAccordion-type1 m-b-8" control="vm.eventsAccordion">

            <v-pane ng-repeat="item in vm.entity.events | orderBy: 'order'"
                    expanded="item.isPaneExpanded">

                <v-pane-header ng-class="{'m-b-0': !$pane.isExpanded()}">
                    <div class="accordion-header-content flex-row fc-space-between fi-center"
                         data-ng-click="vm.toggleItem($pane, item, $event)">

                        <div class="accordion-header-left">

                            <span ng-hide="!$pane.isExpanded()"
                                  class="material-icons accordion-expansion-icon">expand_less</span>
                            <span ng-hide="$pane.isExpanded()"
                                  class="material-icons accordion-expansion-icon">expand_more</span>

                            <span class="text-weight-bold m-r-8"># {{$index + 1}}</span>

                            <div ng-hide="!item.isPaneExpanded" class="accordion-name-input">
                                <text-input model="item.name"
                                            event-signal="vm.evEditorFieldEvent"
                                            on-change-callback="vm.onRequiredFieldChange('events')"
                                            small-options="{notNull: true}"
                                            ng-click="$event.stopPropagation();"></text-input>
                                <!--<md-input-container class="no-error-spacer" style="min-height: 35px">
                                    <label></label>
                                    <input type="text"
                                           ng-model="item.name"
                                           class="ttype-action-notes-input text-weight-bold"
                                           placeholder="name">
                                </md-input-container>-->
                            </div>

                            <span ng-hide="item.isPaneExpanded"
                                  class="text-weight-bold accordion-name-text"
                                  ng-bind="item.name"></span>
                        </div>

                        <div class="accordion-header-right">
                            <md-checkbox ng-model="item.autogenerate"
                                         id="{{'event_autogenerate_' + $index}}"
                                         aria-lable="instrument type events autogenerate"
                                         ng-change="vm.onAutogenerateToggle($event, item)"
                                         ng-click="$event.stopPropagation();">Auto-generate</md-checkbox>

                            <div class="accordion-actions m-l-35">

                                <button class="accordion-header-icon-btn icon-btn-basics"
                                        ng-click="vm.moveUp(item, $event)"
                                        ng-disabled="item.order === 0">
                                    <span class="material-icons">arrow_upward</span>
                                </button>

                                <button class="accordion-header-icon-btn icon-btn-basics"
                                        ng-click="vm.moveDown(item, $event)"
                                        ng-disabled="item.order + 1 === vm.entity.events.length">
                                    <span class="material-icons">arrow_downward</span>
                                </button>

                                <button class="accordion-header-icon-btn icon-btn-basics"

                                        popup
                                        popup-template="{{vm.accordionActionsMenu}}"
                                        popup-data="{
                                            deletePane: vm.deletePane,
                                            makeCopy: vm.makeCopy,
                                            item: item
                                        }"
                                        popup-event-service="vm.popupEventService"
                                        position-relative-to="element"
                                        relative-position-x="left"
                                        relative-position-y="top"
                                        open-on="click"
                                        close-on-click-outside="true"
                                        ng-click="$event.stopPropagation();">
                                    <span class="material-icons">more_vert</span>
                                </button>
                            </div>
                            <!-- <md-button class="md-raised"
                                       style="background: #ffeee8;"
                                       data-ng-click="vm.deletePane(item, $index, $event)">Delete
                            </md-button>
                            <md-button class="md-raised"
                                       data-ng-click="vm.makeCopyOfAction(item, $index, $event)">Make copy
                            </md-button>
                            <md-button class="md-raised" ng-disabled="$index == 0"
                                       data-ng-click="vm.moveUp(item, $index, $event)">Move up
                            </md-button>
                            <md-button class="md-raised" ng-disabled="$index == vm.entity.accruals.length - 1"
                                       data-ng-click="vm.moveDown(item, $index, $event)">Move Down
                            </md-button>
                            <md-button class="md-raised" data-ng-click="vm.toggleItem($pane, item, $event)">
                                <span data-ng-if="item.isPaneExpanded">Collapse</span>
                                <span data-ng-if="!item.isPaneExpanded">Expand</span>
                            </md-button> -->
                        </div>

                    </div>
                </v-pane-header>

                <v-pane-content>

                    <div class="flex-row p-t-10 m-b-10 instrument-type-accordion-top-fields">
                        <text-input label="Message on the form"
                                    placeholder-text="Message on the form"
                                    model="item.data.form_message"
                                    event-signal="vm.evEditorFieldEvent"
                                    small-options="{tooltipText: 'Message on the form', notNull: true}"
                                    on-change-callback="vm.onRequiredFieldChange('events')"
                                    class="p-r-10"
                                    style="flex-basis: 33%;"></text-input>

                        <dropdown-select class="p-r-8"
                                         label="Event class"
                                         model="item.data.event_class"
                                         placeholder-text="Event class"
                                         menu-options="vm.eventClasses"
                                         event-signal="vm.evEditorFieldEvent"
                                         small-options="{tooltipText: 'Event class', notNull: true}"
                                         on-change-callback="vm.onRequiredFieldChange('events')"
                                         style="flex-basis: 33%;"></dropdown-select>
                    </div>

                    <div class="instrument-type-accordion-grid-table instrument-type-event-grid-tables">

                        <grid-table gt-data-service="item.eventItemsGridTableDataService"
                                    gt-event-service="item.eventItemsGridTableEventService"></grid-table>

                        <div class="instrument-type-event-block-items-container">
                            <!--<md-checkbox ng-model="item.data.items_blocked"
                                         ng-change="vm.toggleEventBlockableItems(item)">Receive the below data from Accruals Schedule</md-checkbox>-->
                            <md-checkbox ng-model="item.data.get_items2_from_accruals" ng-disabled="!item.autogenerate">Receive the below data from Accruals Schedule (in case of autogenerate, for each accrual entry)</md-checkbox>
                        </div>

                        <!--<grid-table gt-data-service="item.eventBlockableItemsGridTableDataService"
                                    gt-event-service="item.eventBlockableItemsGridTableEventService"
                                    ng-class="{'disabled-grid-table': item.data.items_blocked}"></grid-table>-->
                        <grid-table gt-data-service="item.eventItems2GridTableDataService"
                                    gt-event-service="item.eventItems2GridTableEventService"></grid-table>
                    </div>

                    <div class="instrument-type-accordion-grid-table grid-table-bordered-rows m-b-16">
                        <grid-table gt-data-service="item.eventActionsGridTableDataService"
                                    gt-event-service="item.eventActionsGridTableEventService"></grid-table>
                    </div>

                    <div class="event-parameter-holder">

                        <div class="m-t-16">

                            <div data-ng-repeat="parameter in item.data.parameters" layout="row" data-ng-if="parameter.index != 0">

                                <md-input-container>
                                    <label>Index</label>
                                    <input type="text" data-ng-model="parameter.index" class="disabled-btn">
                                </md-input-container>

                                <md-input-container>
                                    <label>Name</label>
                                    <input type="text" data-ng-model="parameter.name">
                                </md-input-container>

                                <md-input-container class="m-t-16">
                                    <label>Value Type</label>
                                    <md-select data-ng-model="parameter.value_type"
                                               data-ng-change="vm.multipleParameterValueTypeUpdate(item, parameter.index)">
                                        <md-option value="10">Text</md-option>
                                        <md-option value="20">Number</md-option>
                                        <md-option value="40">Date</md-option>
                                    </md-select>
                                </md-input-container>

                                <div>

                                    <div layout="row" data-ng-if="parameter.___switch_state == 'default_value'">

                                        <md-input-container>
                                            <label>Default Value</label>
                                            <input type="text" data-ng-model="parameter.default_value">
                                        </md-input-container>

                                        <md-button class="md-raised md-primary"
                                                   data-ng-click="vm.switchParameter($event, item, parameter)">Switch
                                        </md-button>

                                    </div>

                                    <div layout="row" data-ng-if="parameter.___switch_state == 'attribute_key'">

                                        <md-input-container class="m-t-16">
                                            <label>Options</label>
                                            <md-select data-ng-model="parameter.attribute_key">
                                                <md-option ng-value="parameter.user_code"
                                                           data-ng-repeat="parameter in vm.optionsForMultipleParameters[parameter.value_type]">
                                                    {{parameter.name}} ({{parameter.user_code}})
                                                </md-option>
                                            </md-select>
                                        </md-input-container>

                                        <md-button class="md-raised md-primary"
                                                   data-ng-click="vm.switchParameter($event, item, parameter)">Switch
                                        </md-button>

                                    </div>

                                </div>


                            </div>

                        </div>

                        <div>
                            <md-button class="md-raised" data-ng-click="vm.addParameter($event, item)">Add Parameter</md-button>
                        </div>

                    </div>

                </v-pane-content>

            </v-pane>

        </v-accordion>

        <div class="flex-row">
            <md-button class="m-l-0 primary-button m-t-0"
                       ng-click="vm.createInstrumentTypeEvent()">+ ADD</md-button>

            <!-- <md-button class="outline-button m-t-0">APPEND FROM TEMPLATE</md-button>

            <md-button class="outline-button m-t-0">SAVE AS TEMPLATE</md-button> -->
        </div>

    </div>

</div>