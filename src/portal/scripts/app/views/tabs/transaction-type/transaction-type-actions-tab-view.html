<div data-ng-controller="TransactionTypeActionsTabController as vm">
    <div class="transaction-type-actions-tab-view">
        <v-accordion class="vAccordion--default" multiple control="accordion">

            <v-pane data-ng-repeat="item in vm.entity.actions" expanded="item.isPaneExpanded">
                <v-pane-header inactive class="transaction-type-action-pane">
                    <div layout="row" layout-align="space-between center">
                        <div layout="row">
                            <span data-ng-if="item.isPaneExpanded">
                                <md-input-container>
                                    <input ng-keydown="vm.preventSpace($event)" type="text"
                                           data-ng-model="item.action_notes" placeholder="Action notes">
                                </md-input-container>
                            </span>
                            <span data-ng-if="!item.isPaneExpanded" data-ng-bind="item.action_notes"></span>
                        </div>
                        <div layout="row">
                            <md-button class="md-raised"
                                       style="background: #ffeee8;"
                                       data-ng-click="vm.deletePane(item, $index, $event)">Delete
                            </md-button>
                            <md-button class="md-raised" ng-disabled="$index == 0"
                                       data-ng-click="vm.moveUp(item, $index)">Move up
                            </md-button>
                            <md-button class="md-raised" ng-disabled="$index == vm.entity.actions.length - 1"
                                       data-ng-click="vm.moveDown(item, $index )">Move Down
                            </md-button>
                            <md-button class="md-raised" data-ng-click="vm.toggleItem($pane, item)">
                                <span data-ng-if="item.isPaneExpanded">Collapse</span>
                                <span data-ng-if="!item.isPaneExpanded">Expand</span>
                            </md-button>
                        </div>
                    </div>
                </v-pane-header>

                <v-pane-content style="padding: 20px;">

                    <div data-ng-if="item.transaction != null">

                        <div layout="row">
                            <div flex="50">
                                <div layout="row">
                                    <md-input-container>
                                        <label for="">Transaction class</label>
                                        <md-select data-ng-model="item.transaction.transaction_class"
                                                   md-on-open="vm.loadRelation('transaction_class')">
                                            <md-option
                                                    data-ng-if="!vm.relationItems['transaction_class'].length"
                                                    ng-value="item.transaction.transaction_class_object.id">
                                                {{item.transaction.transaction_class_object.name}}
                                            </md-option>
                                            <md-option
                                                    data-ng-if="vm.relationItems['transaction_class'].length"
                                                    data-ng-repeat="relationItem in vm.relationItems['transaction_class']"
                                                    ng-value="relationItem.value">
                                                {{relationItem.name}}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <div flex="33">
                                        <div layout="row">
                                            <div flex="20">
                                                <md-button
                                                        class="md-icon-button md-raised {{!!item.transaction.instrument_toggle ? 'ref' : ''}}"
                                                        style="transform: scale(0.7,0.7)"
                                                        data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'instrument')">
                                                    <span data-ng-if="!!item.transaction.instrument_toggle">R</span>
                                                    <span data-ng-if="!!!item.transaction.instrument_toggle">I</span>
                                                </md-button>
                                            </div>
                                            <div flex="80">
                                                <div data-ng-if="item.transaction.instrument_toggle">
                                                    <md-input-container>
                                                        <label for="">Instrument</label>
                                                        <md-select data-ng-model="item.transaction.instrument"
                                                                   md-on-open="vm.loadRelation('instrument')">
                                                            <md-option
                                                                    data-ng-if="!vm.relationItems['instrument'].length"
                                                                    ng-value="item.transaction.instrument_object.id">
                                                                {{item.transaction.instrument_object.name}}
                                                            </md-option>
                                                            <md-option
                                                                    data-ng-if="vm.relationItems['instrument'].length"
                                                                    data-ng-repeat="relationItem in vm.relationItems['instrument']"
                                                                    ng-value="relationItem.id">
                                                                {{relationItem.name}}
                                                            </md-option>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                                <div data-ng-if="!item.transaction.instrument_toggle">
                                                    <md-input-container>
                                                        <label for="">Instrument</label>
                                                        <md-select
                                                                data-ng-model="item.transaction[vm.resolveInstrumentProp(item, 'instrument')]">
                                                            <md-optgroup label="Inputs">
                                                                <md-option
                                                                        data-ng-click="vm.setTransactionInstrumentInput(item, inputItem.name, 'instrument')"
                                                                        data-ng-repeat="inputItem in vm.findInputs('instrument')"
                                                                        ng-value="inputItem.name">
                                                                    {{inputItem.name}}
                                                                </md-option>
                                                            </md-optgroup>
                                                            <md-optgroup label="Phantoms">
                                                                <md-option
                                                                        data-ng-click="vm.setTransactionInstrumentPhantom(item, phantomItem.positionOrder, 'instrument')"
                                                                        data-ng-repeat="phantomItem in vm.findPhantoms()"
                                                                        ng-value="phantomItem.positionOrder">
                                                                    {{phantomItem.action_notes}}
                                                                </md-option>
                                                            </md-optgroup>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Position size with sign</label>
                                            <input type="text" data-ng-model="item.transaction.position_size_with_sign">
                                        </md-input-container>

                                        <expression-editor-button
                                                data-item="item.transaction.position_size_with_sign"></expression-editor-button>

                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.transaction_currency_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'transaction_currency')">
                                                <span data-ng-if="!!item.transaction.transaction_currency_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.transaction_currency_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.transaction_currency_toggle">
                                                <md-input-container>
                                                    <label for="">Transaction currency</label>
                                                    <md-select data-ng-model="item.transaction.transaction_currency"
                                                               md-on-open="vm.loadRelation('transaction_currency')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['transaction_currency'].length"
                                                                ng-value="item.transaction.transaction_currency_object.id">
                                                            {{item.transaction.transaction_currency_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['transaction_currency'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['transaction_currency']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.transaction_currency_toggle">
                                                <md-input-container>
                                                    <label for="">Transaction currency</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.transaction_currency_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('currency')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33">
                                        <div layout="row">
                                            <div flex="20">
                                                <md-button
                                                        class="md-icon-button md-raised {{!!item.transaction.linked_instrument_toggle ? 'ref' : ''}}"
                                                        style="transform: scale(0.7,0.7)"
                                                        data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'linked_instrument')">
                                                    <span data-ng-if="!!item.transaction.linked_instrument_toggle">R</span>
                                                    <span data-ng-if="!!!item.transaction.linked_instrument_toggle">I</span>
                                                </md-button>
                                            </div>
                                            <div flex="80">
                                                <div data-ng-if="item.transaction.linked_instrument_toggle">
                                                    <md-input-container>
                                                        <label for="">Linked instrument</label>
                                                        <md-select data-ng-model="item.transaction.linked_instrument"
                                                                   md-on-open="vm.loadRelation('instrument')">
                                                            <md-option
                                                                    data-ng-if="!vm.relationItems['instrument'].length"
                                                                    ng-value="item.transaction.linked_instrument_object.id">
                                                                {{item.transaction.instrument_object.name}}
                                                            </md-option>
                                                            <md-option
                                                                    data-ng-if="vm.relationItems['instrument'].length"
                                                                    data-ng-repeat="relationItem in vm.relationItems['instrument']"
                                                                    ng-value="relationItem.id">
                                                                {{relationItem.name}}
                                                            </md-option>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                                <div data-ng-if="!item.transaction.linked_instrument_toggle">
                                                    <md-input-container>
                                                        <label for="">Linked instrument</label>
                                                        <md-select
                                                                data-ng-model="item.transaction[vm.resolveInstrumentProp(item, 'linked_instrument')]">
                                                            <md-optgroup label="Inputs">
                                                                <md-option
                                                                        data-ng-click="vm.setTransactionInstrumentInput(item, inputItem.name, 'linked_instrument')"
                                                                        data-ng-repeat="inputItem in vm.findInputs('instrument')"
                                                                        ng-value="inputItem.name">
                                                                    {{inputItem.name}}
                                                                </md-option>
                                                            </md-optgroup>
                                                            <md-optgroup label="Phantoms">
                                                                <md-option
                                                                        data-ng-click="vm.setTransactionInstrumentPhantom(item, phantomItem.positionOrder, 'linked_instrument')"
                                                                        data-ng-repeat="phantomItem in vm.findPhantoms()"
                                                                        ng-value="phantomItem.positionOrder">
                                                                    {{phantomItem.action_notes}}
                                                                </md-option>
                                                            </md-optgroup>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <div layout="row">
                                            <div flex="20">
                                                <md-button
                                                        class="md-icon-button md-raised {{!!item.transaction.allocation_pl_toggle ? 'ref' : ''}}"
                                                        style="transform: scale(0.7,0.7)"
                                                        data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'allocation_pl')">
                                                    <span data-ng-if="!!item.transaction.allocation_pl_toggle">R</span>
                                                    <span data-ng-if="!!!item.transaction.allocation_pl_toggle">I</span>
                                                </md-button>
                                            </div>
                                            <div flex="80">
                                                <div data-ng-if="item.transaction.allocation_pl_toggle">
                                                    <md-input-container>
                                                        <label for="">Allocation-P&L</label>
                                                        <md-select data-ng-model="item.transaction.allocation_pl"
                                                                   md-on-open="vm.loadRelation('instrument')">
                                                            <md-option
                                                                    data-ng-if="!vm.relationItems['instrument'].length"
                                                                    ng-value="item.transaction.instrument_object.id">
                                                                {{item.transaction.instrument_object.name}}
                                                            </md-option>
                                                            <md-option
                                                                    data-ng-if="vm.relationItems['instrument'].length"
                                                                    data-ng-repeat="relationItem in vm.relationItems['instrument']"
                                                                    ng-value="relationItem.id">
                                                                {{relationItem.name}}
                                                            </md-option>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                                <div data-ng-if="!item.transaction.allocation_pl_toggle">
                                                    <md-input-container>
                                                        <label for="">Allocation-P&L</label>
                                                        <md-select
                                                                data-ng-model="item.transaction[vm.resolveInstrumentProp(item, 'allocation_pl')]">
                                                            <md-optgroup label="Inputs">
                                                                <md-option
                                                                        data-ng-click="vm.setTransactionInstrumentInput(item, inputItem.name, 'allocation_pl')"
                                                                        data-ng-repeat="inputItem in vm.findInputs('instrument')"
                                                                        ng-value="inputItem.name">
                                                                    {{inputItem.name}}
                                                                </md-option>
                                                            </md-optgroup>
                                                            <md-optgroup label="Phantoms">
                                                                <md-option
                                                                        data-ng-click="vm.setTransactionInstrumentPhantom(item, phantomItem.positionOrder, 'allocation_pl')"
                                                                        data-ng-repeat="phantomItem in vm.findPhantoms()"
                                                                        ng-value="phantomItem.positionOrder">
                                                                    {{phantomItem.action_notes}}
                                                                </md-option>
                                                            </md-optgroup>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <div layout="row">
                                            <div flex="20">
                                                <md-button
                                                        class="md-icon-button md-raised {{!!item.transaction.allocation_balance_toggle ? 'ref' : ''}}"
                                                        style="transform: scale(0.7,0.7)"
                                                        data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'allocation_balance')">
                                                    <span data-ng-if="!!item.transaction.allocation_balance_toggle">R</span>
                                                    <span data-ng-if="!!!item.transaction.allocation_balance_toggle">I</span>
                                                </md-button>
                                            </div>
                                            <div flex="80">
                                                <div data-ng-if="item.transaction.allocation_balance_toggle">
                                                    <md-input-container>
                                                        <label for="">Allocation-Balance</label>
                                                        <md-select
                                                                data-ng-model="item.transaction.allocation_balance"
                                                                md-on-open="vm.loadRelation('instrument')">
                                                            <md-option
                                                                    data-ng-if="!vm.relationItems['instrument'].length"
                                                                    ng-value="item.transaction.instrument_object.id">
                                                                {{item.transaction.instrument_object.name}}
                                                            </md-option>
                                                            <md-option
                                                                    data-ng-if="vm.relationItems['instrument'].length"
                                                                    data-ng-repeat="relationItem in vm.relationItems['instrument']"
                                                                    ng-value="relationItem.id">
                                                                {{relationItem.name}}
                                                            </md-option>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                                <div data-ng-if="!item.transaction.allocation_balance_toggle">
                                                    <md-input-container>
                                                        <label for="">Allocation-Balance</label>
                                                        <md-select
                                                                data-ng-model="item.transaction[vm.resolveInstrumentProp(item, 'allocation_balance')]">
                                                            <md-optgroup label="Inputs">
                                                                <md-option
                                                                        data-ng-click="vm.setTransactionInstrumentInput(item, inputItem.name, 'allocation_balance')"
                                                                        data-ng-repeat="inputItem in vm.findInputs('instrument')"
                                                                        ng-value="inputItem.name">
                                                                    {{inputItem.name}}
                                                                </md-option>
                                                            </md-optgroup>
                                                            <md-optgroup label="Phantoms">
                                                                <md-option
                                                                        data-ng-click="vm.setTransactionInstrumentPhantom(item, phantomItem.positionOrder, 'allocation_balance')"
                                                                        data-ng-repeat="phantomItem in vm.findPhantoms()"
                                                                        ng-value="phantomItem.positionOrder">
                                                                    {{phantomItem.action_notes}}
                                                                </md-option>
                                                            </md-optgroup>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Trade price</label>
                                            <input type="text" data-ng-model="item.transaction.trade_price">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.trade_price"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Factor</label>
                                            <input type="text" data-ng-model="item.transaction.factor">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.factor"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Position amount</label>
                                            <input type="text" data-ng-model="item.transaction.position_amount">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.position_amount"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Accounting date</label>
                                            <input type="text" style="color: grey"
                                                   data-ng-model="item.transaction.accounting_date">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.accounting_date"></expression-editor-button>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.account_position_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'account_position')">
                                                <span data-ng-if="!!item.transaction.account_position_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.account_position_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.account_position_toggle">
                                                <md-input-container>
                                                    <label for="">Account position</label>
                                                    <md-select data-ng-model="item.transaction.account_position"
                                                               md-on-open="vm.loadRelation('account_position')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['account_position'].length"
                                                                ng-value="item.transaction.account_position_object.id">
                                                            {{item.transaction.account_position_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['account_position'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['account_position']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.account_position_toggle">
                                                <md-input-container>
                                                    <label for="">Account position</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.account_position_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('account')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <md-input-container>
                                            <label for="">&nbsp;</label>
                                        </md-input-container>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.strategy1_position_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'strategy1_position')">
                                                <span data-ng-if="!!item.transaction.strategy1_position_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.strategy1_position_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.strategy1_position_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy1 position</label>
                                                    <md-select data-ng-model="item.transaction.strategy1_position"
                                                               md-on-open="vm.loadRelation('strategy1_position')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['strategy1_position'].length"
                                                                ng-value="item.transaction.strategy1_position_object.id">
                                                            {{item.transaction.strategy1_position_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['strategy1_position'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['strategy1_position']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.strategy1_position_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy1 position</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.strategy1_position_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('strategy-1')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.strategy2_position_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'strategy2_position')">
                                                <span data-ng-if="!!item.transaction.strategy2_position_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.strategy2_position_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.strategy2_position_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy2 position</label>
                                                    <md-select data-ng-model="item.transaction.strategy2_position"
                                                               md-on-open="vm.loadRelation('strategy2_position')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['strategy2_position'].length"
                                                                ng-value="item.transaction.strategy2_position_object.id">
                                                            {{item.transaction.strategy2_position_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['strategy2_position'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['strategy2_position']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.strategy2_position_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy2 position</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.strategy2_position_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('strategy-2')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.strategy3_position_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'strategy3_position')">
                                                <span data-ng-if="!!item.transaction.strategy3_position_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.strategy3_position_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.strategy3_position_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy3 position</label>
                                                    <md-select data-ng-model="item.transaction.strategy3_position"
                                                               md-on-open="vm.loadRelation('strategy3_position')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['strategy3_position'].length"
                                                                ng-value="item.transaction.strategy3_position_object.id">
                                                            {{item.transaction.strategy3_position_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['strategy3_position'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['strategy3_position']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.strategy3_position_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy3 position</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.strategy3_position_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('strategy-3')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="100">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Notes</label>
                                            <input type="text" data-ng-model="item.transaction.notes">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.notes"></expression-editor-button>
                                    </div>
                                </div>
                            </div>
                            <div flex="50">
                                <div layout="row">
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.portfolio_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'portfolio')">
                                                <span data-ng-if="!!item.transaction.portfolio_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.portfolio_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.portfolio_toggle">
                                                <md-input-container>
                                                    <label for="">Portfolio</label>
                                                    <md-select data-ng-model="item.transaction.portfolio"
                                                               md-on-open="vm.loadRelation('portfolio')">
                                                        <md-option data-ng-if="!vm.relationItems['portfolio'].length"
                                                                   ng-value="item.transaction.portfolio_object.id">
                                                            {{item.transaction.portfolio_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['portfolio'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['portfolio']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.portfolio_toggle">
                                                <md-input-container>
                                                    <label for="">Portfolio</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.portfolio_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('portfolio')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.counterparty_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'counterparty')">
                                                <span data-ng-if="!!item.transaction.counterparty_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.counterparty_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.counterparty_toggle">
                                                <md-input-container>
                                                    <label for="">Counterparty</label>
                                                    <md-select data-ng-model="item.transaction.counterparty"
                                                               md-on-open="vm.loadRelation('counterparty')">
                                                        <md-option data-ng-if="!vm.relationItems['counterparty'].length"
                                                                   ng-value="item.transaction.counterparty_object.id">
                                                            {{item.transaction.counterparty_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['counterparty'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['counterparty']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.counterparty_toggle">
                                                <md-input-container>
                                                    <label for="">Counterparty</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.counterparty_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('counterparty')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.responsible_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'responsible')">
                                                <span data-ng-if="!!item.transaction.responsible_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.responsible_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.responsible_toggle">
                                                <md-input-container>
                                                    <label for="">Responsible</label>
                                                    <md-select data-ng-model="item.transaction.responsible"
                                                               md-on-open="vm.loadRelation('responsible')">
                                                        <md-option data-ng-if="!vm.relationItems['responsible'].length"
                                                                   ng-value="item.transaction.responsible_object.id">
                                                            {{item.transaction.responsible_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['responsible'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['responsible']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.responsible_toggle">
                                                <md-input-container>
                                                    <label for="">Responsible</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.responsible_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('responsible')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.settlement_currency_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'settlement_currency')">
                                                <span data-ng-if="!!item.transaction.settlement_currency_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.settlement_currency_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.settlement_currency_toggle">
                                                <md-input-container>
                                                    <label for="">Settlement currency</label>
                                                    <md-select data-ng-model="item.transaction.settlement_currency"
                                                               md-on-open="vm.loadRelation('settlement_currency')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['settlement_currency'].length"
                                                                ng-value="item.transaction.settlement_currency_object.id">
                                                            {{item.transaction.settlement_currency_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['settlement_currency'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['settlement_currency']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.settlement_currency_toggle">
                                                <md-input-container>
                                                    <label for="">Settlement currency</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.settlement_currency_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('currency')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Cash consideration</label>
                                            <input type="text" data-ng-model="item.transaction.cash_consideration">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.cash_consideration"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Reference fx-rate</label>
                                            <input type="text" data-ng-model="item.transaction.reference_fx_rate">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.reference_fx_rate"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Principal with sign</label>
                                            <input type="text" data-ng-model="item.transaction.principal_with_sign">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.principal_with_sign"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Carry with sign</label>
                                            <input type="text" data-ng-model="item.transaction.carry_with_sign">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.carry_with_sign"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Overheads with sign</label>
                                            <input type="text" data-ng-model="item.transaction.overheads_with_sign">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.overheads_with_sign"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Principal amount</label>
                                            <input type="text" data-ng-model="item.transaction.principal_amount">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.principal_amount"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Carry amount</label>
                                            <input type="text" data-ng-model="item.transaction.carry_amount">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.carry_amount"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Overheads</label>
                                            <input type="text" data-ng-model="item.transaction.overheads">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.overheads"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33" layout="row">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Cash date</label>
                                            <input type="text" style="color: grey;"
                                                   data-ng-model="item.transaction.cash_date">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.transaction.cash_date"></expression-editor-button>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.account_cash_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'account_cash')">
                                                <span data-ng-if="!!item.transaction.account_cash_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.account_cash_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.account_cash_toggle">
                                                <md-input-container>
                                                    <label for="">Account cash</label>
                                                    <md-select data-ng-model="item.transaction.account_cash"
                                                               md-on-open="vm.loadRelation('account_cash')">
                                                        <md-option data-ng-if="!vm.relationItems['account_cash'].length"
                                                                   ng-value="item.transaction.account_cash_object.id">
                                                            {{item.transaction.account_cash_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['account_cash'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['account_cash']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.account_cash_toggle">
                                                <md-input-container>
                                                    <label for="">Account cash</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.account_cash_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('account')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.account_interim_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'account_interim')">
                                                <span data-ng-if="!!item.transaction.account_interim_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.account_interim_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.account_interim_toggle">
                                                <md-input-container>
                                                    <label for="">Account interim</label>
                                                    <md-select data-ng-model="item.transaction.account_interim"
                                                               md-on-open="vm.loadRelation('account_interim')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['account_interim'].length"
                                                                ng-value="item.transaction.account_interim_object.id">
                                                            {{item.transaction.account_interim_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['account_interim'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['account_interim']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.account_interim_toggle">
                                                <md-input-container>
                                                    <label for="">Account interim</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.account_interim_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('account')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div layout="row">

                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.strategy1_cash_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'strategy1_cash')">
                                                <span data-ng-if="!!item.transaction.strategy1_cash_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.strategy1_cash_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.strategy1_cash_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy1 cash</label>
                                                    <md-select data-ng-model="item.transaction.strategy1_cash"
                                                               md-on-open="vm.loadRelation('strategy1_cash')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['strategy1_cash'].length"
                                                                ng-value="item.transaction.strategy1_cash_object.id">
                                                            {{item.transaction.strategy1_cash_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['strategy1_cash'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['strategy1_cash']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.strategy1_cash_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy1 cash</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.strategy1_cash_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('strategy-1')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.strategy2_cash_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'strategy2_cash')">
                                                <span data-ng-if="!!item.transaction.strategy2_cash_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.strategy2_cash_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.strategy2_cash_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy2 cash</label>
                                                    <md-select data-ng-model="item.transaction.strategy2_cash"
                                                               md-on-open="vm.loadRelation('strategy2_cash')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['strategy2_cash'].length"
                                                                ng-value="item.transaction.strategy2_cash_object.id">
                                                            {{item.transaction.strategy2_cash_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['strategy2_cash'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['strategy2_cash']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.strategy2_cash_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy2 cash</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.strategy2_cash_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('strategy-2')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.transaction.strategy3_cash_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'transaction', 'strategy3_cash')">
                                                <span data-ng-if="!!item.transaction.strategy3_cash_toggle">R</span>
                                                <span data-ng-if="!!!item.transaction.strategy3_cash_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.transaction.strategy3_cash_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy3 cash</label>
                                                    <md-select data-ng-model="item.transaction.strategy3_cash"
                                                               md-on-open="vm.loadRelation('strategy3_cash')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['strategy3_cash'].length"
                                                                ng-value="item.transaction.strategy3_cash_object.id">
                                                            {{item.transaction.strategy3_cash_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['strategy3_cash'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['strategy3_cash']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.transaction.strategy3_cash_toggle">
                                                <md-input-container>
                                                    <label for="">Strategy3 cash</label>
                                                    <md-select
                                                            data-ng-model="item.transaction.strategy3_cash_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('strategy-3')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div data-ng-if="item.instrument != null">
                        <div layout="row">
                            <div flex="50">
                                <div layout="row">
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.instrument.instrument_type_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'instrument', 'instrument_type')">
                                                <span data-ng-if="!!item.instrument.instrument_type_toggle">R</span>
                                                <span data-ng-if="!!!item.instrument.instrument_type_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div>
                                                <div data-ng-if="item.instrument.instrument_type_toggle">
                                                    <md-input-container>
                                                        <label for="">Instrument type</label>
                                                        <md-select data-ng-model="item.instrument.instrument_type"
                                                                   md-on-open="vm.loadRelation('instrument_type')">
                                                            <md-option
                                                                    data-ng-if="!vm.relationItems['instrument_type'].length"
                                                                    ng-value="item.instrument.instrument_type_object.id">
                                                                {{item.instrument.instrument_type_object.name}}
                                                            </md-option>
                                                            <md-option
                                                                    data-ng-if="vm.relationItems['instrument_type'].length"
                                                                    data-ng-repeat="relationItem in vm.relationItems['instrument_type']"
                                                                    ng-value="relationItem.id">
                                                                {{relationItem.name}}
                                                            </md-option>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                                <div data-ng-if="!item.instrument.instrument_type_toggle">
                                                    <md-input-container>
                                                        <label for="">Instrument type</label>
                                                        <md-select
                                                                data-ng-model="item.instrument.instrument_type_input">
                                                            <md-option
                                                                    data-ng-repeat="inputItem in vm.findInputs('instrument-type')"
                                                                    ng-value="inputItem.name">
                                                                {{inputItem.name}}
                                                            </md-option>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">User code</label>
                                            <input type="text" data-ng-model="item.instrument.user_code">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.user_code"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Name</label>
                                            <input type="text" data-ng-model="item.instrument.name">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.name"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Short name</label>
                                            <input type="text" data-ng-model="item.instrument.short_name">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.short_name"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Public name</label>
                                            <input type="text" data-ng-model="item.instrument.public_name">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.public_name"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">User text1</label>
                                            <input type="text" data-ng-model="item.instrument.user_text_1">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.user_text_1"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">User text2</label>
                                            <input type="text" data-ng-model="item.instrument.user_text_2">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.user_text_2"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">User text3</label>
                                            <input type="text" data-ng-model="item.instrument.user_text_3">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.user_text_3"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="100">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Notes</label>
                                            <input type="text" data-ng-model="item.instrument.notes">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.notes"></expression-editor-button>
                                    </div>
                                </div>
                            </div>
                            <div flex="50">
                                <div layout="row">
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.instrument.daily_pricing_model_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'instrument', 'daily_pricing_model')">
                                                <span data-ng-if="!!item.instrument.daily_pricing_model_toggle">R</span>
                                                <span data-ng-if="!!!item.instrument.daily_pricing_model_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.instrument.daily_pricing_model_toggle">
                                                <md-input-container>
                                                    <label for="">Daily pricing model</label>
                                                    <md-select data-ng-model="item.instrument.daily_pricing_model"
                                                               md-on-open="vm.loadRelation('daily_pricing_model')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['daily_pricing_model'].length"
                                                                ng-value="item.instrument.daily_pricing_model_object.id">
                                                            {{item.instrument.daily_pricing_model_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['daily_pricing_model'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['daily_pricing_model']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.instrument.daily_pricing_model_toggle">
                                                <md-input-container>
                                                    <label for="">Daily pricing model</label>
                                                    <md-select
                                                            data-ng-model="item.instrument.daily_pricing_model_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('daily-pricing-model')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.instrument.price_download_scheme_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'instrument', 'price_download_scheme')">
                                                <span data-ng-if="!!item.instrument.price_download_scheme_toggle">R</span>
                                                <span data-ng-if="!!!item.instrument.price_download_scheme_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.instrument.price_download_scheme_toggle">
                                                <md-input-container>
                                                    <label for="">Price download scheme</label>
                                                    <md-select data-ng-model="item.instrument.price_download_scheme"
                                                               md-on-open="vm.loadRelation('price_download_scheme')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['price_download_scheme'].length"
                                                                ng-value="item.instrument.price_download_scheme_object.id">
                                                            {{item.instrument.price_download_scheme_object.scheme_name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['price_download_scheme'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['price_download_scheme']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.scheme_name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.instrument.price_download_scheme_toggle">
                                                <md-input-container>
                                                    <label for="">Price download scheme</label>
                                                    <md-select
                                                            data-ng-model="item.instrument.price_download_scheme_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('price-download-scheme')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Reference for pricing</label>
                                            <input type="text"
                                                   data-ng-model="item.instrument.reference_for_pricing">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.reference_for_pricing"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.instrument.pricing_currency_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'instrument', 'pricing_currency')">
                                                <span data-ng-if="!!item.instrument.pricing_currency_toggle">R</span>
                                                <span data-ng-if="!!!item.instrument.pricing_currency_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.instrument.pricing_currency_toggle">
                                                <md-input-container>
                                                    <label for="">Pricing currency</label>
                                                    <md-select data-ng-model="item.instrument.pricing_currency"
                                                               md-on-open="vm.loadRelation('pricing_currency')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['pricing_currency'].length"
                                                                ng-value="item.instrument.pricing_currency_object.id">
                                                            {{item.instrument.pricing_currency_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['pricing_currency'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['pricing_currency']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.instrument.pricing_currency_toggle">
                                                <md-input-container>
                                                    <label for="">Pricing currency</label>
                                                    <md-select
                                                            data-ng-model="item.instrument.pricing_currency_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('currency')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Price multiplier</label>
                                            <input type="text" data-ng-model="item.instrument.price_multiplier">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.price_multiplier"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Default price</label>
                                            <input type="text" data-ng-model="item.instrument.default_price">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.default_price"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.instrument.accrued_currency_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'instrument', 'accrued_currency')">
                                                <span data-ng-if="!!item.instrument.accrued_currency_toggle">R</span>
                                                <span data-ng-if="!!!item.instrument.accrued_currency_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.instrument.accrued_currency_toggle">
                                                <md-input-container>
                                                    <label for="">Accrued currency</label>
                                                    <md-select data-ng-model="item.instrument.accrued_currency"
                                                               md-on-open="vm.loadRelation('accrued_currency')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['accrued_currency'].length"
                                                                ng-value="item.instrument.accrued_currency_object.id">
                                                            {{item.instrument.accrued_currency_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['accrued_currency'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['accrued_currency']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.instrument.accrued_currency_toggle">
                                                <md-input-container>
                                                    <label for="">Accrued currency</label>
                                                    <md-select
                                                            data-ng-model="item.instrument.accrued_currency_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('currency')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Accrued multiplier</label>
                                            <input type="text" data-ng-model="item.instrument.accrued_multiplier">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.accrued_multiplier"></expression-editor-button>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Default accrued</label>
                                            <input type="text" data-ng-model="item.instrument.default_accrued">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.default_accrued"></expression-editor-button>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="33" layout="row">
                                        <div flex="20">
                                            <md-button
                                                    class="md-icon-button md-raised {{!!item.instrument.payment_size_detail_toggle ? 'ref' : ''}}"
                                                    style="transform: scale(0.7,0.7)"
                                                    data-ng-click="vm.resetPropertyBtn(item, 'instrument', 'payment_size_detail')">
                                                <span data-ng-if="!!item.instrument.payment_size_detail_toggle">R</span>
                                                <span data-ng-if="!!!item.instrument.payment_size_detail_toggle">I</span>
                                            </md-button>
                                        </div>
                                        <div flex="80">
                                            <div data-ng-if="item.instrument.payment_size_detail_toggle">
                                                <md-input-container>
                                                    <label for="">Payment size details</label>
                                                    <md-select data-ng-model="item.instrument.payment_size_detail"
                                                               md-on-open="vm.loadRelation('payment_size_detail')">
                                                        <md-option
                                                                data-ng-if="!vm.relationItems['payment_size_detail'].length"
                                                                ng-value="item.instrument.payment_size_detail_object.id">
                                                            {{item.instrument.payment_size_detail_object.name}}
                                                        </md-option>
                                                        <md-option
                                                                data-ng-if="vm.relationItems['payment_size_detail'].length"
                                                                data-ng-repeat="relationItem in vm.relationItems['payment_size_detail']"
                                                                ng-value="relationItem.id">
                                                            {{relationItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div data-ng-if="!item.instrument.payment_size_detail_toggle">
                                                <md-input-container>
                                                    <label for="">Payment size details</label>
                                                    <md-select
                                                            data-ng-model="item.instrument.payment_size_detail_input">
                                                        <md-option
                                                                data-ng-repeat="inputItem in vm.findInputs('payment-size-detail')"
                                                                ng-value="inputItem.name">
                                                            {{inputItem.name}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div flex="33">
                                        <md-input-container>
                                            <label for="">&nbsp;</label>
                                        </md-input-container>
                                    </div>
                                    <div flex="33">
                                        <md-input-container class="expression-input-container">
                                            <label for="">Maturity date</label>
                                            <input type="text" style="color: grey"
                                                   data-ng-model="item.instrument.maturity_date">
                                        </md-input-container>
                                        <expression-editor-button
                                                data-item="item.instrument.maturity_date"></expression-editor-button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div data-ng-if="item.instrument_factor_schedule != null">
                        <div layout="row">
                            <div flex="50">
                                <div layout="row">
                                    <div flex="50">
                                        <div layout="row">
                                            <div flex="20">
                                                <md-button
                                                        class="md-icon-button md-raised {{!!item.instrument_factor_schedule.instrument_toggle ? 'ref' : ''}}"
                                                        style="transform: scale(0.7,0.7)"
                                                        data-ng-click="vm.resetPropertyBtn(item, 'instrument_factor_schedule', 'instrument')">
                                                    <span data-ng-if="!!item.instrument_factor_schedule.instrument_toggle">R</span>
                                                    <span data-ng-if="!!!item.instrument_factor_schedule.instrument_toggle">I</span>
                                                </md-button>
                                            </div>
                                            <div flex="80">
                                                <div data-ng-if="item.instrument_factor_schedule.instrument_toggle">
                                                    <md-input-container>
                                                        <label for="">Instrument</label>
                                                        <md-select
                                                                data-ng-model="item.instrument_factor_schedule.instrument"
                                                                md-on-open="vm.loadRelation('instrument')">
                                                            <md-option
                                                                    data-ng-if="!vm.relationItems['instrument'].length"
                                                                    ng-value="item.instrument_factor_schedule.instrument_object.id">
                                                                {{item.transaction.instrument_object.name}}
                                                            </md-option>
                                                            <md-option
                                                                    data-ng-if="vm.relationItems['instrument'].length"
                                                                    data-ng-repeat="relationItem in vm.relationItems['instrument']"
                                                                    ng-value="relationItem.id">
                                                                {{relationItem.name}}
                                                            </md-option>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                                <div data-ng-if="!item.instrument_factor_schedule.instrument_toggle">
                                                    <md-input-container>
                                                        <label for="">Instrument</label>
                                                        <md-select
                                                                data-ng-model="item.instrument_factor_schedule[vm.resolveInstrumentProp(item, 'instrument')]">
                                                            <md-optgroup label="Inputs">
                                                                <md-option
                                                                        data-ng-click="vm.setItemInstrumentInput(item, 'instrument_factor_schedule', inputItem.name, 'instrument')"
                                                                        data-ng-repeat="inputItem in vm.findInputs('instrument')"
                                                                        ng-value="inputItem.name">
                                                                    {{inputItem.name}}
                                                                </md-option>
                                                            </md-optgroup>
                                                            <md-optgroup label="Phantoms">
                                                                <md-option
                                                                        data-ng-click="vm.setItemInstrumentPhantom(item, 'instrument_factor_schedule', phantomItem.positionOrder, 'instrument')"
                                                                        data-ng-repeat="phantomItem in vm.findPhantoms()"
                                                                        ng-value="phantomItem.positionOrder">
                                                                    {{phantomItem.action_notes}}
                                                                </md-option>
                                                            </md-optgroup>
                                                        </md-select>
                                                    </md-input-container>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div layout="row">
                                    <div flex="50">
                                        <div layout="row">
                                            <div flex="50">
                                                <md-input-container class="expression-input-container">
                                                    <label for="">Factor</label>
                                                    <input type="text"
                                                           data-ng-model="item.instrument_factor_schedule.factor_value">
                                                </md-input-container>
                                                <expression-editor-button
                                                        data-item="item.instrument_factor_schedule.factor_value"></expression-editor-button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div flex="50">
                                <div flex="50" layout="row">
                                    <md-input-container class="expression-input-container">
                                        <label for="">Effective date</label>
                                        <input type="text" style="color: grey;"
                                               data-ng-model="item.instrument_factor_schedule.effective_date">
                                    </md-input-container>
                                    <expression-editor-button
                                            data-item="item.instrument_factor_schedule.effective_date"></expression-editor-button>
                                </div>
                            </div>
                        </div>
                    </div>

                </v-pane-content>
            </v-pane>

        </v-accordion>

        <div layout="row" layout-align="end center">
            <md-button class="md-raised" data-ng-click="vm.addAction('transaction')">
                Add new transaction action
            </md-button>
            <md-button class="md-raised" data-ng-click="vm.addAction('instrument')">
                Add new instrument action
            </md-button>
        </div>

        <div layout="row" layout-align="end center" class="m-t-24">
            <md-button class="md-raised" data-ng-click="vm.addAction('instrument_factor_schedule')">
                Add new instrument factor schedule action
            </md-button>
        </div>

    </div>
</div>