<div class="report-viewer-matrix">
    <div data-ng-if="!processing" class="report-viewer-matrix-holder rvMatrixHolder" layout="column">

        <div data-ng-if="viewContext === 'dashboard'" class="g-dashboard-filter-holder">

            <md-button class="toggle-dashboard-filter-btn"
                       ng-click="dashboardFilterCollapsed = !dashboardFilterCollapsed">
                <ng-md-icon ng-hide="dashboardFilterCollapsed"
                            icon="keyboard_arrow_left"></ng-md-icon>
                <ng-md-icon ng-hide="!dashboardFilterCollapsed"
                            icon="keyboard_arrow_right"></ng-md-icon>
            </md-button>

            <div class="g-dashboard-filter">

                <group-dashboard-filter data-ng-show="!dashboardFilterCollapsed"
                                        ev-data-service="evDataService"
                                        ev-event-service="evEventService"></group-dashboard-filter>
            </div>

        </div>

        <div class="report-viewer-matrix-row rv-matrix-header" flex="noshrink">

            <div class="report-viewer-matrix-column-header-cell report-viewer-empty-header-cell text-{{styles.cell.text_align}} rvMatrixCell">
                <span data-ng-if="!top_left_title" title="-">-</span>
                <span data-ng-if="top_left_title" title="{{top_left_title}}">{{top_left_title}}</span>

                <md-menu>
                    <md-button class="matrix-settings-button"
                               ng-click="$mdOpenMenu($event)">
                        <ng-md-icon icon="settings"></ng-md-icon>
                    </md-button>
                    <md-menu-content width="3">
                        <md-menu-item>
                            <md-menu >

                                <md-button aria-label="show number formatting menu"
                                           ng-click="$mdOpenMenu($event)">
                                    <span>Number Format</span>
                                </md-button>

                                <md-menu-content width="4">

                                    <md-menu-item>
                                        <md-button ng-click="setNumberFormatPreset('price')"
                                                   class="g-settings-option-btn">
                                            <span>Price (0)</span>
                                        </md-button>
                                    </md-menu-item>

                                    <md-menu-item>
                                        <md-button ng-click="setNumberFormatPreset('market_value')"
                                                   class="g-settings-option-btn">
                                            <span>Market Value (000'000)</span>
                                        </md-button>
                                    </md-menu-item>

                                    <md-menu-item>
                                        <md-button class="g-settings-option-btn"
                                                   ng-click="setNumberFormatPreset('amount')">
                                            <span>Amount (000'000.00)</span>
                                        </md-button>
                                    </md-menu-item>

                                    <md-menu-item>
                                        <md-button class="g-settings-option-btn"
                                                   ng-click="setNumberFormatPreset('exposure')">
                                            <span>Exposure (0.0%)</span>
                                        </md-button>
                                    </md-menu-item>

                                    <md-menu-item>
                                        <md-button class="g-settings-option-btn"
                                                   ng-click="setNumberFormatPreset('return')">
                                            <span>Return (0.00%)</span>
                                        </md-button>
                                    </md-menu-item>

                                    <md-menu-item>
                                        <md-button class="g-settings-option-btn"
                                                   ng-click="openNumberFormatSettings($event)">
                                            <span>Custom</span>
                                        </md-button>
                                    </md-menu-item>

                                </md-menu-content>
                            </md-menu>
                        </md-menu-item>

                        <md-menu-item>
                            <md-button ng-click="setSubtotalType(1)"
                                       class="g-settings-option-btn">
                                <span>Subtotal SUM</span>
                            </md-button>
                        </md-menu-item>

                        <md-menu-item>
                            <md-menu md-offset="18px 0">
                                <md-button aria-label="Open phone interactions menu"
                                           class=""
                                           ng-click="$mdOpenMenu($event)">
                                    <span>Subtotal Weighted</span>
                                    <ng-md-icon icon="arrow_drop_up"
                                                class="z-dropdown-icon"></ng-md-icon>
                                </md-button>
                                <md-menu-content width="3">
                                    <md-menu-item>
                                        <md-button ng-click="setSubtotalType(2)"
                                                   class="g-settings-option-btn">
                                            <span>Market Value</span>
                                        </md-button>
                                    </md-menu-item>
                                    <md-menu-item>
                                        <md-button ng-click="setSubtotalType(3)"
                                                   class="g-settings-option-btn">
                                            <span>Market Value %</span>
                                        </md-button>
                                    </md-menu-item>
                                    <md-menu-item>
                                        <md-button ng-click="setSubtotalType(4)"
                                                   class="g-settings-option-btn">
                                            <span>Exposure</span>
                                        </md-button>
                                    </md-menu-item>
                                    <md-menu-item>
                                        <md-button ng-click="setSubtotalType(5)"
                                                   class="g-settings-option-btn">
                                            <span>Exposure %</span>
                                        </md-button>
                                    </md-menu-item>
                                </md-menu-content>
                            </md-menu>
                        </md-menu-item>

                        <md-menu-item>
                            <md-menu>
                                <md-button aria-label="Open phone interactions menu"
                                           class=""
                                           ng-click="$mdOpenMenu($event)">
                                    <span>Subtotal Avg. Weighted</span>
                                    <ng-md-icon icon="arrow_drop_up"
                                                class="z-dropdown-icon"></ng-md-icon>
                                </md-button>
                                <md-menu-content width="3">
                                    <md-menu-item>
                                        <md-button ng-click="setSubtotalType(6)"
                                                   class="g-settings-option-btn">
                                            <span>Market Value</span>
                                        </md-button>
                                    </md-menu-item>
                                    <md-menu-item>
                                        <md-button ng-click="setSubtotalType(7)"
                                                   class="g-settings-option-btn">
                                            <span>Market Value %</span>
                                        </md-button>
                                    </md-menu-item>
                                    <md-menu-item>
                                        <md-button ng-click="setSubtotalType(8)"
                                                   class="g-settings-option-btn">
                                            <span>Exposure</span>
                                        </md-button>
                                    </md-menu-item>
                                    <md-menu-item>
                                        <md-button ng-click="setSubtotalType(9)"
                                                   class="g-settings-option-btn">
                                            <span>Exposure %</span>
                                        </md-button>
                                    </md-menu-item>
                                </md-menu-content>
                            </md-menu>
                        </md-menu-item>
                    </md-menu-content>
                </md-menu>
            </div>

            <div class="rvm-header-row-holder">
                <div class="rv-matrix-part-to-scroll rvmHeaderScrollableRow">
                    <div class="report-viewer-matrix-column-header-cell rvMatrixCell"
                         data-ng-class="{'active': activeItem == 'column_total:' + $index}"
                         title="{{column}}"
                         data-ng-click="singleColumnTotalClick($event, $index)"
                         data-ng-repeat="column in columns track by $index">
                        {{column}}
                    </div>

                    <!--<div class="report-viewer-matrix-cell report-viewer-matrix-column-header-cell report-viewer-cell-border-left rvMatrixCell"
                         title="TOTAL"
                         data-ng-class="{'active': activeItem == 'columns_total'}"
                         data-ng-click="columnsTotalClick($event)">
                        TOTAL
                    </div>-->

                    <!-- Blank cell that serves as placeholder for position absolute column with totals -->
                    <!--                <div class="report-viewer-matrix-cell rvMatrixCell"></div>-->
                </div>
            </div>

            <div class="rv-matrix-header-total-cell text-{{styles.cell.text_align}} rvMatrixCell"
                 title="TOTAL"
                 data-ng-class="{'active': activeItem == 'columns_total'}"
                 data-ng-click="columnsTotalClick($event)">
                TOTAL
            </div>

        </div>

        <div class="rv-matrix-body" layout="row" flex="grow">

            <div class="rv-matrix-fixed-bottom-row rvMatrixFixedBottomRow">
                <div class="rv-matrix-part-to-scroll rvmBottomRowScrollableElem">
                    <div data-ng-repeat="item in totals.columns track by $index"
                         class="report-viewer-matrix-cell rv-matrix-colored-cell text-{{styles.cell.text_align}} rvMatrixCell"
                         title="{{item.total}}"
                         data-ng-click="singleColumnTotalClick($event, $index)"
                         data-ng-class="{'active': activeItem == 'column_total:' + $index, 'negative-red': checkNegative(item.total)}">
                        {{formatValue(item.total)}}
                    </div>
                </div>

                <div class="report-viewer-matrix-cell rv-matrix-row-total-cell text-{{styles.cell.text_align}} rvMatrixCell"
                     title="TOTAL"
                     data-ng-click="rowsTotalClick($event)"
                     data-ng-class="{'active': activeItem == 'rows_total'}">
                    TOTAL
                </div>

                <div class="report-viewer-matrix-cell rv-matrix-rb-cell text-{{styles.cell.text_align}} rvMatrixCell"
                     title="{{totals.total}}"
                     data-ng-click="totalClick($event)"
                     data-ng-class="{'active': activeItem == 'total', 'negative-red': checkNegative(totals.total)}">
                    {{formatValue(totals.total)}}
                </div>
            </div>

            <div class="rv-matrix-left-col rvMatrixLeftCol">
                <div class="rvm-fixed-col-holder">
                    <div class="rv-matrix-part-to-scroll scrollableMatrixBodyColumn">
                        <div data-ng-repeat="row in matrix track by row.index"
                             class="report-viewer-matrix-cell rv-matrix-colored-cell text-{{styles.cell.text_align}} rvMatrixCell"
                             title="{{row.row_name}}"
                             data-ng-click="singleRowTotalClick($event, row.index)"
                             data-ng-class="{'active': activeItem == 'row_total:' + row.index}">
                            {{row.row_name}}
                        </div>
                    </div>

                    <!--<div class="report-viewer-matrix-cell rv-matrix-row-total-cell rvMatrixCell"
                         title="TOTAL"
                         data-ng-click="rowsTotalClick($event)"
                         data-ng-class="{'active': activeItem == 'rows_total'}">
                        TOTAL
                    </div>-->
                </div>
            </div>

            <div class="rv-matrix-value-cells-container rvMatrixBodyScrolls">

                <div class="position-relative rvMatrixValueRowsHolder">
                    <div data-ng-repeat="row in matrix track by row.index" class="report-viewer-matrix-row rvMatrixRow">

                        <div class="report-viewer-matrix-cell rvMatrixCell text-{{styles.cell.text_align}}"
                             data-ng-repeat="item in row.items track by item.index"
                             title="{{item.data.value}}"
                             data-ng-click="cellClick($event, row.index, item.index)"
                             data-ng-class="{'active': activeItem == 'cell:' + row.index + ':' + item.index, 'negative-red': checkNegative(item.data.value)}">

                            {{formatValue(item.data.value)}}

                        </div>

                        <!--<div class="report-viewer-matrix-cell report-viewer-cell-border-left rv-matrix-colored-cell text-{{styles.cell.text_align}} rvMatrixCell"
                             title="{{totals.rows[row.index].total}}"
                             data-ng-click="singleRowTotalClick($event, row.index)"
                             data-ng-class="{'active': activeItem == 'row_total:' + row.index, 'negative-red': checkNegative(totals.rows[row.index].total)}">
                            {{formatValue(totals.rows[row.index].total)}}
                        </div>-->

                        <div class="report-viewer-matrix-cell rvMatrixCell"></div>

                    </div>

                    <!--<div class="report-viewer-matrix-row report-viewer-matrix-bottom-row">
                        &lt;!&ndash; Blank cell that serves as placeholder for position absolute row with totals &ndash;&gt;
                        <div class="report-viewer-matrix-cell rvMatrixCell rv-matrix-colored-cell"></div>
                    </div>-->
                </div>

            </div>

            <div class="rv-matrix-right-col rvMatrixRightCol">
                <div class="rv-matrix-part-to-scroll scrollableMatrixBodyColumn">
                    <div data-ng-repeat="row in matrix track by row.index" class="report-viewer-matrix-row rvMatrixRow">
                        <div class="report-viewer-matrix-cell report-viewer-cell-border-left rv-matrix-colored-cell text-{{styles.cell.text_align}} rvMatrixCell"
                             title="{{totals.rows[row.index].total}}"
                             data-ng-click="singleRowTotalClick($event, row.index)"
                             data-ng-class="{'active': activeItem == 'row_total:' + row.index, 'negative-red': checkNegative(totals.rows[row.index].total)}">
                            {{formatValue(totals.rows[row.index].total)}}
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <div data-ng-if="processing">
        <div layout="row" layout-sm="column" layout-align="space-around" class="loader-center-64">
            <!--<md-progress-circular md-mode="indeterminate" md-diameter="64"></md-progress-circular>-->
            <progress-circular diameter="50"></progress-circular>
        </div>
    </div>

</div>