<div ng-if="readyStatus.content">

    <div data-ng-if="type === 'id'">

        <div data-ng-if="isSpecialSearchRelation()">


            <div data-ng-if="modelKeyEntity == 'instrument'">

                <instrument-select
                        label="{{getName()}}"
                        model="entity[fieldKey]"
                        item-object="entity[fieldKey + '_object']"
                        on-change-callback="changeHandler()"
                        item-name="inputTextObj.value"
                        custom-buttons="item.buttons"
                        custom-styles="customStyles"
                ></instrument-select>

            </div>

            <div data-ng-if="modelKeyEntity == 'counterparty'">

                <unified-data-select
                        label="{{getName()}}"
                        model="entity[fieldKey]"
                        item-object="entity[fieldKey + '_object']"
                        on-change-callback="changeHandler()"
                        item-name="inputTextObj.value"
                        custom-buttons="item.buttons"
                        custom-styles="customStyles"
                        entity-type="'counterparty'"
                ></unified-data-select>

            </div>

            <div data-ng-if="modelKeyEntity != 'instrument' && modelKeyEntity != 'counterparty'">
                <entity-search-select item="entity[fieldKey]"
                                      label="getName()"
                                      item-name="inputTextObj.value"
                                      item-object="entity[fieldKey + '_object']"
                                      on-change-callback="changeHandler()"
                                      custom-buttons="item.buttons"
                                      custom-styles="customStyles"
                                      event-signal="ciEventObj.event"
                                      small-options="{notNull: options.notNull, tooltipText: tooltipText}"
                                      entity-type="modelKeyEntity"
                                      on-change-callback="changeHandler()"></entity-search-select>
            </div>
        </div>

        <div data-ng-if="!isSpecialSearchRelation()">
            <div data-ng-if="checkComplexEntityType()">
                <md-input-container
                        class="md-block no-error-spacer"
                        aria-label="select with search"
                >
                    <label data-ng-bind="getName()"></label>

                    <md-select
                            md-on-close="searchTerm = ''"
                            data-ng-model="entity[fieldKey]"
                            data-ng-change="changeHandler()"
                            md-on-open="getData()"
                            md-selected-text="bindFormFields()"
                            md-container-class="common-select-container"
                            style="{{inputBackgroundColor()}}"
                    >
                        <md-select-header>
                            <input
                                    data-ng-model="searchTerm"
                                    type="search"
                                    placeholder="Search for a ..."
                                    class="md-text md-select-search-pattern select-input-filter"
                                    ng-keydown="$event.stopPropagation()"
                            />
                        </md-select-header>

                        <div data-ng-if="groups" class="select-options-holder">
                            <md-optgroup
                                    data-ng-repeat="group in groups | orderBy:'-'+group.name track by group.id"
                                    data-ng-if="group.fields.length"
                                    label="{{group.name}}"
                            >
                                <md-option
                                        data-ng-repeat="field in group.fields | orderBy:resolveSort(field) | filter:{name: searchTerm} track by $index"
                                        ng-value="field.id"
                                >
                                    {{bindListFields(field)}}
                                </md-option>
                            </md-optgroup>
                        </div>

                        <div
                                data-ng-if="!groups && field && field[0]"
                                class="select-options-holder"
                        >
                            <md-option data-ng-value="fields[0].id"
                            >{{bindListFields(fields[0])}}
                            </md-option
                            >
                        </div>
                    </md-select>
                </md-input-container>
            </div>

            <div data-ng-if="!checkComplexEntityType()">
                <div data-ng-if="fieldKey !== 'price_download_scheme'">
                    <div data-ng-if="!checkForCrudSelects()">
<!--                                      <md-input-container class="md-block no-error-spacer md-select-pan">
                                        <label data-ng-bind="getName()"></label>
                                        <md-select
                                          md-on-close="searchTerm = ''"
                                          data-ng-model="entity[fieldKey]"
                                          data-ng-change="changeHandler()"
                                          md-on-open="getData()"
                                          md-selected-text="bindFormFields()"
                                          md-container-class="common-select-container"
                                          style="{{inputBackgroundColor()}}"
                                        >
                                          <md-select-header>
                                            <input
                                              data-ng-model="searchTerm"
                                              type="search"
                                              placeholder="Search for a ..."
                                              class="md-text md-select-search-pattern select-input-filter"
                                              ng-keydown="$event.stopPropagation()"
                                            />
                                          </md-select-header>

                                          <div class="select-options-holder">
                                            <md-option
                                              data-ng-repeat="field in fields | orderBy:resolveSort(field) | filter:{name: searchTerm} as results track by field.id "
                                              ng-value="field.id">
                                              {{bindListFields(field)}}
                                            </md-option>
                                          </div>

                                        </md-select>
                                      </md-input-container>-->

                        <dropdown-select class="p-r-8" label="{{getName()}}"
                                         model="entity[fieldKey]"
                                         placeholder-text="{{getName()}}"
                                         menu-options="sortedFields"
                                         small-options="{tooltipText: '{{getName()}}'}"
                                         sorted="sorted"
                                         on-change-callback="changeHandler()"
                                         style="{{inputBackgroundColor()}}">
                        </dropdown-select>

                    </div>

                    <div data-ng-if="checkForCrudSelects()">

                        <div data-ng-if="readyStatus.content">
                            <crud-select data-label="getName()"
                                         data-item="entity[fieldKey]"
                                         data-entity-type="crudEntityType"
                                         data-options="fields"
                                         data-ng-click="getData()"
                                         event-signal="ciEventObj.event"
                                         small-options="{notNull: options.notNull}"
                            ></crud-select>
                        </div>

                    </div>
                </div>

                <div data-ng-if="fieldKey == 'price_download_scheme'">

                    <!--                <md-input-container class="md-block no-error-spacer">
                                        <label data-ng-bind="getName()"></label>
                                        <md-select
                                                md-on-close="searchTerm = ''"
                                                data-ng-model="entity[fieldKey]"
                                                data-ng-change="changeHandler()"
                                                md-on-open="getData()"
                                                md-container-class="common-select-container"
                                                style="{{inputBackgroundColor()}}"
                                        >
                                            <md-select-header>
                                                <input
                                                        data-ng-model="searchTerm"
                                                        type="search"
                                                        placeholder="Search for a ..."
                                                        class="md-text md-select-search-pattern select-input-filter"
                                                        ng-keydown="$event.stopPropagation()"
                                                />
                                            </md-select-header>
                                            <div class="select-options-holder">
                                                <md-option
                                                        data-ng-repeat="field in fields | orderBy:'-'+field.user_code | filter:{user_code:searchTerm} track by field.id "
                                                        ng-value="field.id"
                                                >
                                                    {{field['user_code']}}
                                                </md-option>
                                            </div>
                                        </md-select>
                                    </md-input-container>-->

                    <dropdown-select class="p-r-8" label="{{getName()}}"
                                     model="entity[fieldKey]"
                                     placeholder-text="{{getName()}}"
                                     menu-options="schemeSortedFields"
                                     small-options="{tooltipText: '{{getName()}}'}"
                                     sorted="sorted"
                                     on-change-callback="changeHandler()"
                                     style="{{inputBackgroundColor()}}">
                    </dropdown-select>

                </div>
            </div>
        </div>

    </div>

    <div data-ng-if="type === 'multiple-ids'">

        <div data-ng-if="checkComplexEntityType()">
            <!--      <md-input-container class="md-block no-error-spacer">-->
            <!--        <label data-ng-bind="getName()"></label>-->
            <!--        <md-select-->
            <!--          md-on-close="searchTerm = ''"-->
            <!--          md-on-open="getData()"-->
            <!--          data-ng-model="entity[fieldKey]"-->
            <!--          data-ng-change="changeHandler()"-->
            <!--          multiple="true"-->
            <!--          md-selected-text="bindMCField()"-->
            <!--          style="{{inputBackgroundColor()}}"-->
            <!--        >-->
            <!--          <md-select-header>-->
            <!--            <input-->
            <!--              data-ng-model="searchTerm"-->
            <!--              type="search"-->
            <!--              placeholder="Search for a ..."-->
            <!--              class="md-text md-select-search-pattern"-->
            <!--              ng-keydown="$event.stopPropagation()"-->
            <!--            />-->
            <!--          </md-select-header>-->

            <!--          <div data-ng-if="groups && groups.length" class="select-options-holder">-->
            <!--            <md-optgroup-->
            <!--              data-ng-repeat="group in groups | orderBy:'-'+group.name track by group.id"-->
            <!--              data-ng-if="group.fields.length"-->
            <!--              label="{{group.name}}"-->
            <!--            >-->
            <!--              <md-option-->
            <!--                data-ng-repeat="field in group.fields | orderBy:resolveSort(field) | filter:{name: searchTerm}"-->
            <!--                ng-value="field.id"-->
            <!--              >-->
            <!--                {{bindListFields(field)}}-->
            <!--              </md-option>-->
            <!--            </md-optgroup>-->
            <!--          </div>-->

            <!--          <div-->
            <!--            data-ng-if="!groups && field && field[0]"-->
            <!--            class="select-options-holder"-->
            <!--          >-->
            <!--            <md-option data-ng-value="fields[0].id"-->
            <!--              >{{bindListFields(fields[0])}}</md-option-->
            <!--            >-->
            <!--          </div>-->
            <!--        </md-select>-->
            <!--      </md-input-container>-->

            <two-fields-multiselect ng-model="entity[fieldKey]"
                                    title="{{getName()}}"
                                    model="entity[fieldKey]"
                                    items="sortedFields"
                                    name-property="bindFieldsName"
                                    selected-items-indication="chips"
                                    on-change-callback="changeHandler()"></two-fields-multiselect>

        </div>

        <div data-ng-if="!checkComplexEntityType()">
            <div data-ng-if="fieldKey !== 'content_types'">
                <!--        <md-input-container class="md-block no-error-spacer">
                          <label data-ng-bind="getName()"></label>
                          <md-select
                            md-on-close="searchTerm = ''"
                            md-on-open="getData()"
                            data-ng-model="entity[fieldKey]"
                            data-ng-change="changeHandler()"
                            md-selected-text="bindMCField()"
                            multiple="true"
                            style="{{inputBackgroundColor()}}"
                          >
                            <md-select-header>
                              <input
                                data-ng-model="searchTerm"
                                type="search"
                                placeholder="Search for a ..."
                                class="md-text md-select-search-pattern"
                                ng-keydown="$event.stopPropagation()"
                              />
                            </md-select-header>
                            <md-option
                              data-ng-repeat="field in fields | orderBy:resolveSort(field) | filter:{name: searchTerm} track by field.id"
                              ng-value="field.id"
                            >
                              {{bindListFields(field)}}
                            </md-option>
                          </md-select>
                        </md-input-container>-->

                <!--TODO ask when to use 2020.10.21 -->
                <!--Victor: I it got back because server need the array-->
                <two-fields-multiselect ng-model="entity[fieldKey]"
                                        title="{{getName()}}"
                                        model="entity[fieldKey]"
                                        name-property="bindFieldsName"
                                        items="sortedFields"
                                        data-selected-items-indication="chips"
                                        on-change-callback="changeHandler()"></two-fields-multiselect>


                <!--        <md-input-container class="md-block no-error-spacer">
                          <label data-ng-bind="getName()"></label>
                          <md-select
                            md-on-close="searchTerm = ''"
                            md-on-open="getData()"
                            data-ng-model="entity[fieldKey]"
                            data-ng-change="changeHandler()"
                            md-selected-text="bindFormFields()"
                            md-container-class="common-select-container"
                            style="{{inputBackgroundColor()}}"
                          >
                            <md-select-header>
                              <input
                                data-ng-model="searchTerm"
                                type="search"
                                placeholder="Search for a ..."
                                class="md-text md-select-search-pattern select-input-filter"
                                ng-keydown="$event.stopPropagation()"
                              />
                            </md-select-header>
                            <div class="select-options-holder">
                              <md-option
                                data-ng-repeat="field in fields | orderBy:resolveSort(field) | filter:{name: searchTerm} track by field.id"
                                ng-value="field.id">
                                {{bindListFields(field)}}
                              </md-option>
                            </div>
                          </md-select>
                        </md-input-container>-->

                <!--    Victor: dropdown return one value, but server need array. I use two-fields-multiselect above
                        <dropdown-select class="p-r-8" label="{{getName()}}"
                                         model="entity[fieldKey]"
                                         placeholder-text="{{getName()}}"
                                         menu-options="sortedFields"
                                         small-options="{tooltipText: '{{getName()}}'}"
                                         sorted="sorted"
                                         style="{{inputBackgroundColor()}}">
                        </dropdown-select>
                -->
            </div>

            <div data-ng-if="fieldKey === 'content_types'">
                <!--        <md-input-container class="md-block no-error-spacer">
                          <label data-ng-bind="getName()"></label>
                          <md-select
                            md-on-close="searchTerm = ''"
                            md-on-open="getData()"
                            data-ng-model="entity[fieldKey]"
                            data-ng-change="changeHandler()"
                            md-selected-text="bindMCField()"
                            multiple="true"
                            style="{{inputBackgroundColor()}}"
                          >
                            <md-select-header>
                              <input
                                data-ng-model="searchTerm"
                                type="search"
                                placeholder="Search for a ..."
                                class="md-text md-select-search-pattern"
                                ng-keydown="$event.stopPropagation()"
                              />
                            </md-select-header>
                            <md-option
                              data-ng-repeat="field in fields | orderBy:'-'+field.name | filter:{name: searchTerm}"
                              ng-value="field.key"
                            >
                              {{field.name}}
                            </md-option>
                          </md-select>
                        </md-input-container>-->

                <dropdown-select class="p-r-8"
                                 label="{{getName()}}"
                                 model="entity[fieldKey]"
                                 placeholder-text="{{getName()}}"
                                 menu-options="sortedFields"
                                 small-options="{tooltipText: '{{getName()}}'}"
                                 sorted="sorted"
                                 on-change-callback="changeHandler()"
                                 style="{{inputBackgroundColor()}}">
                </dropdown-select>

            </div>
        </div>

    </div>

</div>
