<md-dialog aria-label="" class="configuration-import-dialog-view draggable-dialog" drag-dialog>
    <md-toolbar>
        <div class="md-toolbar-tools">
            <is-draggable-sign></is-draggable-sign>

            <h2>Configuration import manager</h2>
            <span flex></span>
            <div class="toolbar-progression-indication" data-ng-if="vm.activeItemTotal">
                <span>Import Progress:</span> <span>{{vm.counter}} / {{vm.activeItemTotal}}</span>
            </div>
        </div>
    </md-toolbar>
    <md-dialog-content style="background: #fff; padding: 16px">

        <div class="m-t-16 m-b-16" data-ng-if="vm.file.notes">

            <p class="m-t-0">Notes: </p>

            <div data-ng-bind="vm.file.notes"></div>
        </div>

        <div>

            <md-checkbox ng-checked="vm.selectAllState"
                         data-ng-click="vm.toggleSelectAll()"
                         class="m-b-0"
                         aria-label="checkbox">
            </md-checkbox>

            <b>Select all</b>

        </div>

        <div data-ng-repeat="item in vm.items | orderBy: 'order__'">

            <h1 ng-if="item.first_level_header__"
                ng-bind="item.first_level_header__"
                class="cie-first-level-group-h1"></h1>
            <h2 data-ng-if="item.first_item__"
                data-ng-bind="item.first_item__"
                class="cie-entities-group-h2"></h2>

            <div class="cie-entity-holder" data-ng-class="{
                      'text-warning-red': item.is_duplicate && vm.settings.mode == 'overwrite',
                      'text-warning-blue': item.is_duplicate && vm.settings.mode == 'skip'}">
                <md-checkbox data-ng-checked="item.active"
                             data-ng-click="vm.toggleActiveForChildren(item)"
                             data-ng-class="{'some-checkboxes-ticked': item.someChildsActive}"
                             aria-label="checkbox">
                </md-checkbox>
                <span data-ng-bind="vm.getEntityName(item)"
                      data-ng-class="{
                      'used-dynamic-attrs': item.attributeIsUsed__}"></span>
                <span
                        class="cie-dependency"
                        data-ng-bind="vm.getEntityDependenciesCaptions(item)"></span>
                ({{item.count}})

                <span data-ng-if="item.is_duplicate" class="cursor-pointer"><ng-md-icon
                        icon="warning"
                        size="18">
                            <md-tooltip class="tooltip_2"
                                        md-direction="top">Warning. Some items of this entity already exist in ecosystem</md-tooltip>
                        </ng-md-icon></span>


                <md-button class="md-raised" ng-click="item.displayItems = !item.displayItems"
                           aria-label="display items button"><span
                        data-ng-if="!item.displayItems">Show</span><span data-ng-if="item.displayItems">Hide</span>
                </md-button>
            </div>


            <div data-ng-show="item.displayItems" class="cie-entity-items-holder">

                <div data-ng-repeat="child in item.content | orderBy: 'order__'">
                    <h4 data-ng-if="child.first_item__" data-ng-bind="child.first_item__"></h4>
                    <md-checkbox data-ng-checked="child.active"
                                 data-ng-click="vm.updateActiveForParent(child, item)"
                                 aria-label="checkbox">
                    </md-checkbox>
                    <span data-ng-class="{
                    'used-dynamic-attrs': child.countOfUsages__ || child.countOfUsages__ === 0,
                    'child-with-icon': vm.checkForTextIcon(item.entity, child),
                    'text-warning-red': child.is_duplicate && vm.settings.mode == 'overwrite',
                    'text-warning-blue': child.is_duplicate && vm.settings.mode == 'skip'}">
                        <ng-md-icon data-ng-if="vm.checkForTextIcon(item.entity, child)" icon="folder" fill="#000"
                                    size="20"></ng-md-icon>
                        {{vm.getItemName(child)}}
                        <span data-ng-if="child.countOfUsages__ || child.countOfUsages__ === 0">(<b>{{child.countOfUsages__}}</b>)</span>

                        <span data-ng-if="child.is_duplicate && vm.settings.mode == 'overwrite'" class="cursor-pointer"><ng-md-icon
                                icon="warning"
                                size="18">
                            <md-tooltip class="tooltip_2"
                                        md-direction="top">Warning. You already have this entity, it will be overwritten</md-tooltip>
                        </ng-md-icon></span>

                        <span data-ng-if="child.is_duplicate && vm.settings.mode == 'skip'" class="cursor-pointer"><ng-md-icon
                                icon="warning"
                                size="18">
                            <md-tooltip class="tooltip_2"
                                        md-direction="top">Will not be imported as it is already exists</md-tooltip>
                        </ng-md-icon></span>
                    </span>
                </div>

            </div>


        </div>

        <div data-ng-if="vm.dataSettings.length > 0 || vm.downloadSchemes.length > 0 || vm.systemElements.length > 0">

            <h2>Mappings</h2>

            <div ng-if="vm.dataSettings.length > 0">

                <h2 class="cie-entities-group-h2">Data Settings</h2>

                <div data-ng-repeat="item in vm.dataSettings"
                     class="cie-mapping-group-item">

                    <div class="cie-entity-holder">
                        <md-checkbox data-ng-checked="item.active"
                                     data-ng-click="vm.toggleActiveForChildren(item)"
                                     data-ng-class="{'some-checkboxes-ticked': item.someChildsActive}"
                                     aria-label="checkbox">
                        </md-checkbox>
                        <span data-ng-bind="vm.getMappingsEntityName(item)"></span>
                        ({{item.count}})
                        <md-button class="md-raised" ng-click="item.displayItems = !item.displayItems"><span
                                data-ng-if="!item.displayItems">Show</span><span data-ng-if="item.displayItems">Hide</span>
                        </md-button>
                    </div>


                    <div data-ng-show="item.displayItems" style="padding-left: 20px; position: relative;">
                        <div data-ng-repeat="child in item.content">
                            <md-checkbox data-ng-checked="child.active"
                                         data-ng-click="vm.updateActiveForParent(child, item)"
                                         aria-label="checkbox">
                            </md-checkbox>
                            {{child.value}}
                        </div>
                    </div>

                </div>
            </div>

            <div ng-if="vm.downloadSchemes.length > 0">

                <h2 class="cie-entities-group-h2">Schemes: Download</h2>

                <div data-ng-repeat="item in vm.downloadSchemes"
                     class="cie-mapping-group-item">

                    <div class="cie-entity-holder">
                        <md-checkbox data-ng-checked="item.active"
                                     data-ng-click="vm.toggleActiveForChildren(item)"
                                     data-ng-class="{'some-checkboxes-ticked': item.someChildsActive}"
                                     aria-label="checkbox">
                        </md-checkbox>
                        <span data-ng-bind="vm.getMappingsEntityName(item)"></span>
                        ({{item.count}})
                        <md-button class="md-raised" ng-click="item.displayItems = !item.displayItems"><span
                                data-ng-if="!item.displayItems">Show</span><span data-ng-if="item.displayItems">Hide</span>
                        </md-button>
                    </div>


                    <div data-ng-show="item.displayItems" style="padding-left: 20px; position: relative;">
                        <div data-ng-repeat="child in item.content">
                            <md-checkbox data-ng-checked="child.active"
                                         data-ng-click="vm.updateActiveForParent(child, item)"
                                         aria-label="checkbox">
                            </md-checkbox>
                            {{child.value}}
                        </div>
                    </div>

                </div>
            </div>

            <div ng-if="vm.systemElements.length > 0">

                <h2 class="cie-entities-group-h2">System Elements</h2>

                <div data-ng-repeat="item in vm.systemElements"
                     class="cie-mapping-group-item">

                    <div class="cie-entity-holder">
                        <md-checkbox data-ng-checked="item.active"
                                     data-ng-click="vm.toggleActiveForChildren(item)"
                                     data-ng-class="{'some-checkboxes-ticked': item.someChildsActive}"
                                     aria-label="checkbox">
                        </md-checkbox>
                        <span data-ng-bind="vm.getMappingsEntityName(item)"></span>
                        ({{item.count}})
                        <md-button class="md-raised" ng-click="item.displayItems = !item.displayItems"><span
                                data-ng-if="!item.displayItems">Show</span><span data-ng-if="item.displayItems">Hide</span>
                        </md-button>
                    </div>


                    <div data-ng-show="item.displayItems" style="padding-left: 20px; position: relative;">
                        <div data-ng-repeat="child in item.content">
                            <md-checkbox data-ng-checked="child.active"
                                         data-ng-click="vm.updateActiveForParent(child, item)"
                                         aria-label="checkbox">
                            </md-checkbox>
                            {{child.value}}
                        </div>
                    </div>

                </div>
            </div>

        </div>


        <div class="configuration-import-loader" data-ng-if="vm.processing || !vm.readyStatus.duplicates">
            <md-progress-circular md-mode="indeterminate"
                                  md-diameter="48"></md-progress-circular>
        </div>

    </md-dialog-content>

    <md-dialog-actions layout="row" layout-align="space-between center"
                       style="border-top: 1px solid #ddd; min-height: 66px">

        <div class="p-t-8">

            <md-input-container style="width: 540px;">
                <label>Actions to do with the configurable entities in case if entity User Code exists</label>
                <md-select
                        data-ng-model="vm.settings.mode">
                    <md-option value="skip">Skip</md-option>
                    <md-option value="overwrite">Overwrite</md-option>
                </md-select>
            </md-input-container>

        </div>

        <div>

            <md-button class="md-raised" ng-click="vm.cancel()" aria-label="cancel button">
                Close
            </md-button>

            <md-button class="md-raised" data-ng-class="{'disabled-btn': vm.processing || !vm.readyStatus.member || !vm.readyStatus.groups}"

                       ng-click="vm.agree($event)"
                       style="margin-right:20px;" aria-label="import button">
                Import
            </md-button>

        </div>
    </md-dialog-actions>
</md-dialog>