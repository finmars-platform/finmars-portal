<md-dialog class="g-report-settings-dialog-view draggable-dialog"
           drag-dialog
           aria-label="g report settings dialog">
    <md-toolbar>
        <!--<div class="md-toolbar-tools">
            <is-draggable-sign></is-draggable-sign>

            <h2>Report settings</h2>
        </div>-->
        <dialog-header title="Report Settings"
                       cancel-dialog="vm.cancel()"></dialog-header>
    </md-toolbar>

    <md-dialog-content class="p-t-24">

        <div data-ng-if="vm.checkReadyStatus()" class="p-8">

            <div data-ng-if="vm.entityType == 'balance-report' || vm.entityType == 'pl-report' || vm.entityType == 'performance-report'">

                <h5 class="default-f-s">General Settings</h5>

                <div class="flex-column">

                    <!--<div class="g-report-settings-row p-b-8" data-ng-if="vm.entityType == 'pl-report'">
                        <div class="default-f-s">First Date</div>
                        <date-input model="vm.reportOptions.pl_first_date" class="g-report-settings-field"></date-input>
                    </div>


                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Date</div>
                        <date-input model="vm.reportOptions.report_date" class="g-report-settings-field"></date-input>
                    </div>-->

                    <div ng-if="vm.entityType === 'balance-report'"
                         class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Report date</div>

                        <div class="g-report-settings-field">
                            <complex-zh-datepicker date="vm.reportOptions.report_date"
                                                   datepicker-options="vm.reportLayoutOptions.datepickerOptions.reportLastDatepicker"
                                                   ev-data-service="vm.evDataService"
                                                   ev-event-service="vm.evEventService"
                                                   attribute-data-service="vm.attributeDataService"
                                                   is-disabled="vm.disableDatepicker"
                                                   selector-look="input"></complex-zh-datepicker>
                        </div>
                    </div>

                    <div ng-if="vm.entityType === 'pl-report'"
                         class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Report date</div>

                        <div class="g-report-settings-field">
                            <complex-zh-datepicker date="vm.reportOptions.pl_first_date"
                                                   datepicker-options="vm.reportLayoutOptions.datepickerOptions.reportFirstDatepicker"
                                                   second-date="vm.reportOptions.report_date"
                                                   second-datepicker-options="vm.reportLayoutOptions.datepickerOptions.reportLastDatepicker"
                                                   ev-data-service="vm.evDataService"
                                                   ev-event-service="vm.evEventService"
                                                   attribute-data-service="vm.attributeDataService"
                                                   is-disabled="vm.disableDatepicker"
                                                   selector-look="input"></complex-zh-datepicker>
                        </div>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Currency</div>
                        <dropdown-select model="vm.reportOptions.report_currency"
                                         menu-options="vm.currencies"
                                         small-options="{tooltipText: 'Currency'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Cost method</div>

                        <dropdown-select model="vm.reportOptions.cost_method"
                                         menu-options="vm.costMethod"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Pricing Policy</div>

                        <dropdown-select model="vm.reportOptions.pricing_policy"
                                         menu-options="vm.pricingPolicies"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Table font size</div>

                        <dropdown-select model="vm.tableFontSize"
                                         menu-options="vm.tableFontSizeOptions"
                                         small-options="{tooltipText: 'Table font size'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Expression Iterations Count</div>
                        <dropdown-select model="vm.reportOptions.expression_iterations_count"
                                         menu-options="vm.expressionIterationsCountOptions"
                                         small-options="{tooltipText: 'Custom Fields Calculation Depth'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                </div>

                <h5 class="default-f-s">Consolidation</h5>

                <div class="flex-column">

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Portfolio mode</div>

                        <dropdown-select model="vm.reportOptions.portfolio_mode"
                                         menu-options="vm.selectOptions"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Account mode</div>

                        <dropdown-select model="vm.reportOptions.account_mode"
                                         menu-options="vm.selectOptions"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Strategy 1 Mode</div>

                        <dropdown-select model="vm.reportOptions.strategy1_mode"
                                         menu-options="vm.strategiesSelectOptions"
                                         small-options="{tooltipText: 'Strategy 1 Mode'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Strategy 2 Mode</div>

                        <dropdown-select model="vm.reportOptions.strategy2_mode"
                                         menu-options="vm.strategiesSelectOptions"
                                         small-options="{tooltipText: 'Strategy 2 Mode'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Strategy 3 Mode</div>

                        <dropdown-select model="vm.reportOptions.strategy3_mode"
                                         menu-options="vm.strategiesSelectOptions"
                                         small-options="{tooltipText: 'Strategy 3 Mode'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8" ng-if="vm.entityType === 'pl-report'">
                        <div class="default-f-s">Allocation mode</div>

                        <dropdown-select model="vm.reportOptions.allocation_mode"
                                         menu-options="vm.selectOptions"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Offsetting Size</div>

                        <dropdown-select model="vm.reportOptions.approach_multiplier"
                                         menu-options="vm.approachMultiplierOptions"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                </div>

                <h5 class="default-f-s">Filters</h5>

                <div class="flex-column">

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Portfolios multiselector</div>

                        <two-fields-multiselect get-data-method="vm.getPortfolios()"
                                                model="vm.reportOptions.portfolios"
                                                selected-items="vm.reportOptions.portfolios"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                name-property="short_name"
                                                small-options="{tooltipText: 'Portfolios multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Accounts multiselector</div>

                        <two-fields-multiselect get-data-method="vm.getAccounts()"
                                                model="vm.reportOptions.accounts"
                                                selected-items="vm.reportOptions.accounts"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                name-property="short_name"
                                                small-options="{tooltipText: 'Accounts multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Strategies 1 multiselector</div>

                        <two-fields-multiselect get-data-method="vm.getStrategies1()"
                                                model="vm.reportOptions.strategies1"
                                                data-selected-items="vm.reportOptions.strategies1"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                data-name-property="short_name"
                                                small-options="{tooltipText: 'Strategies 1 multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Strategies 2 multiselector</div>

                        <two-fields-multiselect get-data-method="vm.getStrategies2()"
                                                model="vm.reportOptions.strategies2"
                                                data-selected-items="vm.reportOptions.strategies2"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                data-name-property="short_name"
                                                small-options="{tooltipText: 'Strategies 2 multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Strategies 3 multiselector</div>

                        <two-fields-multiselect get-data-method="vm.getStrategies3()"
                                                model="vm.reportOptions.strategies3"
                                                data-selected-items="vm.reportOptions.strategies3"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                data-name-property="short_name"
                                                small-options="{tooltipText: 'Strategies 3 multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                </div>

                <h4 class="default-f-s">Market Value/Exposure %</h4>

                <div class="flex-column">

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Calculation Grouping</div>

                        <dropdown-select data-model="vm.reportOptions.calculation_group"
                                         data-menu-options="vm.calculationGroupOptions"
                                         data-small-options="{tooltipText: 'Calculation Grouping'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Custom Fields</div>

                        <two-fields-multiselect data-items="vm.customFieldsNames"
                                                data-model="vm.selectedCustomFields"
                                                data-selected-items="vm.selectedCustomFields"
                                                data-nothing-selected-text="Off"
                                                data-selected-items-indication="chips"
                                                data-on-change-callback="vm.selectedCustomFieldsChanged()"
                                                data-name-property="name"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <div class="flex-row-reverse">
                        <div class="g-report-settings-field">
                            <md-input-container class="m-0">
                                <md-checkbox data-ng-model="vm.reportOptions.show_balance_exposure_details"
                                             class="m-b-20">
                                    Show exposure details
                                </md-checkbox>
                            </md-input-container>

                            <md-input-container class="m-0">
                                <md-checkbox data-ng-model="vm.reportOptions.show_transaction_details">
                                    Show transaction details
                                </md-checkbox>
                            </md-input-container>

                            <md-input-container class="m-0">
                                <md-checkbox data-ng-model="vm.reportOptions.ignore_cache">
                                    Ignore Cache
                                </md-checkbox>
                            </md-input-container>

                            <md-input-container class="m-0" ng-if="vm.entityType === 'balance-report'">
                                <md-checkbox data-ng-model="vm.reportOptions.calculate_pl">
                                    Calculate P&L
                                </md-checkbox>
                            </md-input-container>

                        </div>

                    </div>

                </div>

                <!-- <div layout="row">

                    <div layout="column" class="m-r-16">

                        <md-input-container style="margin-bottom: 20px;">
                            <label for="">Account mode</label>
                            <md-select data-ng-model="vm.reportOptions.account_mode">
                                <md-option ng-value="opt.value" ng-repeat="opt in vm.selectOptions">
                                    {{opt.caption}}
                                </md-option>
                            </md-select>
                        </md-input-container>

                    </div>

                    <div layout="column">

                        <md-input-container style="margin-bottom: 20px;">
                            <label for="">Strategy 1 mode</label>
                            <md-select data-ng-model="vm.reportOptions.strategy1_mode">
                                <md-option ng-value="opt.value" ng-repeat="opt in vm.strategiesSelectOptions">
                                    {{opt.caption}}
                                </md-option>
                            </md-select>
                        </md-input-container>

                        <md-input-container style="margin-bottom: 20px;">
                            <label for="">Strategy 2 mode</label>
                            <md-select data-ng-model="vm.reportOptions.strategy2_mode">
                                <md-option ng-value="opt.value" ng-repeat="opt in vm.strategiesSelectOptions">
                                    {{opt.caption}}
                                </md-option>
                                </md-option>
                            </md-select>
                        </md-input-container>

                        <md-input-container style="margin-bottom: 20px;">
                            <label for="">Strategy 3 mode</label>
                            <md-select data-ng-model="vm.reportOptions.strategy3_mode">
                                <md-option ng-value="opt.value" ng-repeat="opt in vm.strategiesSelectOptions">
                                    {{opt.caption}}
                                </md-option>
                                </md-option>
                            </md-select>
                        </md-input-container>

                    </div>

                    <div layout="row">

                        <md-input-container>
                            <label for="">Offsetting size</label>
                            <md-select data-ng-model="vm.reportOptions.approach_multiplier">
                                <md-option ng-value="0">0/100</md-option>
                                <md-option ng-value="0.5">50/50</md-option>
                                <md-option ng-value="1">100/0</md-option>
                            </md-select>
                        </md-input-container>

                    </div>

                </div> -->

            </div>

            <div data-ng-if="vm.entityType == 'transaction-report'">

                <h5 class="default-f-s">General Settings</h5>

                <div class="flex-column">

                    <!--<div class="g-report-settings-row p-b-8" >
                        <div class="default-f-s">Date from</div>
                        <date-input model="vm.reportOptions.begin_date" class="g-report-settings-field"></date-input>
                    </div>


                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Date to</div>
                        <date-input model="vm.reportOptions.end_date" class="g-report-settings-field"></date-input>
                    </div>-->
                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Report date</div>

                        <div class="g-report-settings-field">
                            <complex-zh-datepicker date="vm.reportOptions.begin_date"
                                                   datepicker-options="vm.reportLayoutOptions.datepickerOptions.reportFirstDatepicker"
                                                   second-date="vm.reportOptions.end_date"
                                                   second-datepicker-options="vm.reportLayoutOptions.datepickerOptions.reportLastDatepicker"
                                                   ev-data-service="vm.evDataService"
                                                   ev-event-service="vm.evEventService"
                                                   attribute-data-service="vm.attributeDataService"
                                                   is-disabled="vm.disableDatepicker"
                                                   selector-look="input"></complex-zh-datepicker>
                        </div>
                    </div>


                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Table font size</div>

                        <dropdown-select model="vm.tableFontSize"
                                         menu-options="vm.tableFontSizeOptions"
                                         small-options="{tooltipText: 'Table font size'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Expression Iterations Count</div>

                        <dropdown-select model="vm.reportOptions.expression_iterations_count"
                                         menu-options="vm.expressionIterationsCountOptions"
                                         small-options="{tooltipText: 'Custom Fields Calculation Depth'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-8" data-ng-if="vm.fieldsReady">
                        <div class="default-f-s">Date Field</div>

                        <dropdown-select model="vm.reportOptions.date_field"
                                         menu-options="vm.dateFieldOptions"
                                         small-options="{tooltipText: 'Date field'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Custom Fields</div>

                        <two-fields-multiselect items="vm.customFieldsNames"
                                                model="vm.selectedCustomFields"
                                                selected-items="vm.selectedCustomFields"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                on-change-callback="vm.selectedCustomFieldsChanged()"
                                                name-property="name"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <hr>

                    <div class="g-report-settings-row p-b-8">
                        <div class="default-f-s">Depth Level</div>

                        <dropdown-select model="vm.reportOptions.depth_level"
                                         menu-options="vm.depthLevelOptions"
                                         small-options="{tooltipText: 'Depth Level'}"
                                         class="g-report-settings-field">
                        </dropdown-select>
                    </div>


                </div>

                <h5 class="default-f-s">Filters</h5>

                <div class="flex-column">

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Portfolios multiselector</div>

                        <two-fields-multiselect data-get-data-method="vm.getPortfolios()"
                                                data-model="vm.reportOptions.portfolios"
                                                data-selected-items="vm.reportOptions.portfolios"
                                                data-nothing-selected-text="Off"
                                                data-selected-items-indication="chips"
                                                data-name-property="short_name"
                                                data-small-options="{tooltipText: 'Portfolios multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Accounts multiselector</div>

                        <two-fields-multiselect get-data-method="vm.getAccounts()"
                                                model="vm.reportOptions.accounts"
                                                selected-items="vm.reportOptions.accounts"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                name-property="short_name"
                                                small-options="{tooltipText: 'Accounts multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Strategies 1 multiselector</div>

                        <two-fields-multiselect get-data-method="vm.getStrategies1()"
                                                model="vm.reportOptions.strategies1"
                                                data-selected-items="vm.reportOptions.strategies1"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                data-name-property="short_name"
                                                small-options="{tooltipText: 'Strategies 1 multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Strategies 2 multiselector</div>

                        <two-fields-multiselect get-data-method="vm.getStrategies2()"
                                                model="vm.reportOptions.strategies2"
                                                data-selected-items="vm.reportOptions.strategies2"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                data-name-property="short_name"
                                                small-options="{tooltipText: 'Strategies 2 multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                    <div class="g-report-settings-row p-b-16">
                        <div class="default-f-s">Strategies 3 multiselector</div>

                        <two-fields-multiselect get-data-method="vm.getStrategies3()"
                                                model="vm.reportOptions.strategies3"
                                                data-selected-items="vm.reportOptions.strategies3"
                                                nothing-selected-text="Off"
                                                selected-items-indication="chips"
                                                data-name-property="short_name"
                                                small-options="{tooltipText: 'Strategies 3 multiselector'}"
                                                class="g-report-settings-field"></two-fields-multiselect>
                    </div>

                </div>

            </div>

        </div>

        <div data-ng-if="!vm.checkReadyStatus()" style="height: 140px;">
            <div layout="row" layout-sm="column" layout-align="space-around">
                <progress-circular diameter="100"></progress-circular>
            </div>
        </div>

    </md-dialog-content>

    <md-dialog-actions class="flex_cb">
        <md-button class="link-button" ng-click="vm.cancel()">
            Close
        </md-button>
        <md-button data-ng-if="!vm.disableChangesSaving" class="md-raised md-primary" ng-click="vm.saveSettings()">
            Ok
        </md-button>
    </md-dialog-actions>
</md-dialog>
